/*! Copyright Viafoura bacf3e9 1485876602 | https://cdn.viafoura.net/licenses.txt */
vfWdgts([2],{72:function(e,t,i){var s,n;(function(o){try{s=[i(12),i(9),i(10),i(50),i(18),i(15),i(54),i(34),i(70),i(63),i(73),i(75),i(76),i(89),i(92),i(108),i(107),i(67)],n=function(e,t,i,s,n,r,a,l,h,c,d,m,u,p,f,g,v,_){var w=c.extend({templateName:"commenting",mixins:[h],events:{"click .vf-load-more":"loadMoreComments","click .vf-show-all":"loadAllComments"},initialize:function(e){t.bindAll(this,"onCommentsError","onCommentsSuccess","loadMoreComments","loadMoreSuccess","loadMoreError","canView","onWindowChange","loadNewComments","isLoadedThread","updateRealtimeCount","realtimeToggle");var i={},s=this.$el.attr("data-path"),n=this.$el.attr("data-title"),o=this.$el.attr("data-unique_id");if(this.realtimeIDs=[],this.numCommentsMade=0,this.isShare=!1,s&&this.currentPage.get("path")!==s){var r=this.$el.attr("data-section");r&&(i.section=r),s=this.parsePath(s),i.title=n||this.locations.domain+s,o&&(i.unique_id=o),i.path=s,e.page=new l,e.page.getPage(i),e.page.on("change:id",function(){this.todoInitialize(e)}.bind(this))}else this.todoInitialize(e)},onIsOnScreen:function(){this.hasRealtime()&&(this.rtToggledOn=!0,this.listenTo(a,"rt-comment-throttler",this.handleThrottleEvent),a.subscribe({namespace:"rt-comment-throttler",interval:3e5}),this.realtimeToggle(this.rtToggledOn,!1)),this.runShareLoader()},onWindowChange:function(){var t=n.isElementPartiallyInViewport(this.$el),s=_.parseHash();(t||s)&&(e(window).off(this.realtimeUID),this.onIsOnScreen(),this.stopListening(this,"windowChange"),t&&!s&&i.trigger("/commenting/page/load-thread",this.page))},runShareLoader:function(){_.fetchShare({page:this.page}).done(this.showSharedComment.bind(this)).fail(this.showPageComments.bind(this))},todoInitialize:function(t){this.user=this.currentUser,this.page=t.page||this.currentPage,this.section=t.section,this.settings=this.domainSettings,this.sort=this.$el.attr("data-sort")||this.settings.get("commenting_sort"),this.listenTo(this,"windowChange",this.onWindowChange),this.realtimeUID=".vf-rt-commenting-"+this.$el.data("widget-id"),e(window).off(this.realtimeUID),e(window).on("DOMContentLoaded"+this.realtimeUID+" load"+this.realtimeUID+" resize"+this.realtimeUID+" scroll"+this.realtimeUID,this.onWindowChange),this.pageSettings=new m({page:this.page});var n={};this.settings.get("comment_thread_replies")&&(n.child_limit=this.settings.get("comment_thread_replies")),this.collection=this.threads=this.page.threads(n),this.collection.settings.limit=this.$el.attr("data-limit")||10,this.collection.sortBy(this.sort)||(r.warn("data-sort value is invalid ("+this.sort+")"),this.sort=this.collection.defaultSort);var o=this.hasRealtime();this.views={login_dashboard:new d({user:this.user,settings:this.settings,hasRealtime:o}),page_count:new g({model:this.page,hasRealtime:o}),comments_options:new p({model:this.page,settings:this.settings,isShare:this.isShare,hasRealtime:o,sort:this.sort}),comments:new v({view:f,collection:this.collection,canView:this.canView,hasRealtime:o})},this.views.comment_box=new u({section:this.section,page:this.page,user:this.user,settings:this.settings,loginDashboard:this.views.login_dashboard,hasRealtime:o}),this.domainSettings.get("enable_anonymous_comments")&&this.$el.addClass("vf-enable-anonymous"),this.listenTo(this.page,"change:status",this.onStatusChange),this.listenTo(i,"comment:created",this.addComment),this.listenTo(this.user,"change:id",this.userChanged),this.listenTo(this.views.comments_options,"change:sort",this.changeCommentSort),this.listenTo(this.views.comments_options,"fetch",this.loadNewComments),this.listenTo(this.views.comments_options,"visible",this.isLoadedThread),this.listenTo(this.views.comments_options,"new_rt_comment",this.addRealtimeID),this.listenTo(this.views.comments_options,"realtime-toggle",this.realtimeToggle),this.listenTo(i,"/commenting/reload",this.reloadComments),this.render(),this.checkScrollDown(),this.listenTo(this.views.comments,"render add",this.toggleLoadingButtons),this.listenTo(this.views.comments,"render add",this.toggleNoCommentsMessage),this.listenTo(s,"content",this.realtimeUpdate),e(window).on("hashchange",this.onHashChange.bind(this)),i.trigger("onWidgetLoad",this.$el[0],"onCommentingLoad"),i.trigger("/commenting/resize")},hasRealtime:function(){var e;return(!this.page||(e=this.page.get("status"),"closed"!==e&&"hidden"!==e))&&!!this.settings.get("enable_realtime")},hasCommentLimit:function(){return 1===this.domainSettings.get("enable_email_verification")&&this.user.isLoggedIn()&&this.user.hasCommentLimit()},canView:function(e,t){return!(!this.user.canAnonymouslyPost()||!e.has("user")||e.get("user").name!==this.user.get("name"))||(e.has("user")&&e.get("user").id===this.user.id||this.user.isModOrAdmin()||"completed"===e.get("processing_status")||"removed"===e.get("processing_status"))},isLoadedThread:function(e,t){var i=this.collection.isLoadedThread(e);return t?void t(i):i},showPageComments:function(){e.fn.loader.hideErrors(),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0,inside:!0}).addClass("vf-comment-sorting-loader"),this.collection=this.threads,this.views.comments.setCollection(this.collection),this.collection.fetchBeginning({success:function(){this.views.comments_options.realtimeReset(),this.onCommentsSuccess()}.bind(this),error:this.onCommentsError})},loadNewComments:function(t){t="newest";var s=this.collection,n=this;e.fn.loader.hideErrors(),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0}).addClass("vf-comment-sorting-loader"),i.trigger("threads:cleanRealtimeNew"),s.multiFetch({realtimeNewComment:!0}).add(this.realtimeIDs).add("fetchPageBefore",{reverse:!0}).success(function(e,t){e.sort(n.sortRealtimeResponses);for(var i=0,o=0;o<e.length;o++)i+=n.processModels(e[o],s);i>0&&s.trigger("sync"),n.updateRealtimeCount(i)}).error(this.onCommentsError)},processModels:function(e,t){var s=e.get("thread_id"),n=e.get("id"),o=0;if(s===n)t.isLoadedThread(n)||(o+=1,e.thread&&(o+=e.thread.length),t.add(e,{at:0}));else if(t.isLoadedThread(s)){var r=t.get(s).thread;r&&r.contains(e)||(o+=1,i.trigger("comment:created",e))}return o},sortRealtimeResponses:function(e,t){if(e.get("id")===t.get("id")){var i=e.get("thread")||{results:[]},s=t.get("thread")||{results:[]};return i.results.length<s.results.length?1:-1}if(e.get("id")!==e.get("thread_id")){if(t.get("id")===t.get("thread_id"))return 1}else if(t.get("id")!==t.get("thread_id"))return-1;return e.get("date_created")===t.get("date_created")?0:e.get("date_created")>t.get("date_created")?1:-1},showSharedComment:function(t){var i=_.parseHash();this.isShare=!0,this.views.comments_options.isShare=this.isShare,this.views.comments_options.realtimeReset(),this.collection=t,this.views.comments.setCollection(this.collection),this.views.comments.render(),e(window).scrollTop(this.$el.position().top);var s=this.views.comments.views[0],n=s.findComment(function(e){return e.model.id===i});n.$el.addClass("vf-comment-background-highlight"),o(function(){n.$el.removeClass("vf-comment-background-highlight")},5e3)},render:function(){var e=this.page.get("status"),t={commentingClosed:"closed"===e,hasCommentBox:"closed"!==e&&"hidden"!==e,hasCommentOptions:"hidden"!==e,hasComments:"hidden"!==e,hasCommentMeta:"hidden"!==e,hasLoginDashboard:"hidden"!==e&&!this.settings.get("disable_widget_logins"),hasRealtime:this.hasRealtime(),hasEmailVerification:1===this.domainSettings.get("enable_email_verification")};return this.$el.html(this.template(t)),this.insertSubViews(this.views),this.showPageSettings(),this.$el.toggleClass("vf-is-logged-in",this.user.isLoggedIn()),this.$view_all_btn=this.$(".vf-show-all-con"),this.$show_more_btn=this.$(".vf-load-more-con"),this.toggleLoadingButtons(),this.settings.get("viafoura_branding")||this.$(".vf-branding").remove(),this.trigger("windowChange"),this},insertCommentForm:function(){var e=this.$('div[data-view="comment_box"]');0===e.length&&(e=this.$("div.vf-comment-box")),e.replaceWith(this.views.comment_box.el),this.views.comment_box.render(),this.$el.removeClass("vf-remove-form")},clearComments:function(){this.views.comments.clear(),this.$view_all_btn.hide(),this.$show_more_btn.hide()},toggleNoCommentsMessage:function(){if(this.collection.isEmpty()){var e=this.i18n("no_comments");"editor-picks"==this.sort&&(e=this.i18n("no_comments_editors_pick")),this.views.comments.$el.html("<p class='vf-no-messages'>"+e+"</p>")}else this.views.comments.$(".vf-no-messages").remove();i.trigger("/commenting/resize")},toggleLoadingButtons:function(){this.$view_all_btn.toggle(this.isShare),this.$show_more_btn.toggle(!!this.collection.after_count),this.$show_more_btn.children(".vf-error-message").remove(),this.$view_all_btn.children(".vf-error-message").remove()},changeCommentSort:function(e){this.sort=e,this.reloadComments()},reloadComments:function(){this.clearComments(),this.views.comments_options.realtimeReset(),this.collection.sortBy(this.sort),this.collection.fetchBeginning({success:this.onCommentsSuccess,error:this.onCommentsError}),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0,inside:!0}).addClass("vf-comment-sorting-loader")},onCommentsSuccess:function(){this.$(".vf-horizontal-list").loader("hide")},onCommentsError:function(){this.$(".vf-horizontal-list").loader("hide");var e=this.i18n("something_went_wrong");this.$(".vf-horizontal-list").html("<div class='vf-error-message'>"+e+"</div>")},addComment:function(e){var t={slide:!0};return this.page.id===e.get("parent_id")&&(this.numCommentsMade+=1,this.page.trigger("comment-created",this.page),t.prepend=!0,t.at=0,this.collection.add(e,t)),this},loadAllComments:function(t){t.preventDefault();var i=e(window).scrollTop();_.clearShare(),this.showPageComments(),this.isShare=!1,this.views.comments_options.isShare=!1,e(window).scrollTop(i)},closeReplyBoxes:function(){this.views.comments.each(function(e){e.closeReplies()})},loadMoreComments:function(e){e.preventDefault(),this.$show_more_btn.children(".vf-error-message").remove(),this.$show_more_btn.hide(),this.$show_more_btn.loader("show",{loaderSize:"large",block:!0}),this.collection.fetchPageAfter({success:this.loadMoreSuccess,error:this.loadMoreError})},loadMoreSuccess:function(){this.$show_more_btn.loader("hide"),i.trigger("/commenting/page/load-more",this.page)},loadMoreError:function(){this.$show_more_btn.show().loader("hide"),this.$show_more_btn.children(".vf-error-message").remove();var e=this.i18n("something_went_wrong");this.$show_more_btn.append("<div class='vf-error-message'>"+e+"</div>")},showPageSettings:function(){this.user.isModOrAdmin()?this.$(".vf-page-settings").empty().append(this.pageSettings.render().$el):this.pageSettings.remove()},onStatusChange:function(){this.collection.before_count=0,this.render(),this.page.isClosed()&&this.closeReplyBoxes()},userChanged:function(){this.showPageSettings(),this.$el.toggleClass("vf-is-logged-in",this.user.isLoggedIn()),this.clearComments(),_.fetchShare({page:this.page}).done(this.showSharedComment.bind(this)).fail(this.showPageComments.bind(this)),this.page.fetch({batch:!0})},onHashChange:function(){_.parseHash()&&(i.trigger("/sharelink/show"),i.trigger("/modal/close"),this.clearComments(),_.fetchShare({page:this.page}).done(this.showSharedComment.bind(this)).fail(this.showPageComments.bind(this)))},updateRealtimeCount:function(e){this.numCommentsMade=0,e=e>0?e:1/0,this.views.comments_options.realtimeIncrement(-e),this.onCommentsSuccess(),i.trigger("/commenting/page/rt-load-more",this.page)},realtimeIsOn:function(){return a.isActive("rt-comment-throttler")&&this.rtToggledOn},realtimeToggle:function(e,t,i){this.rtToggledOn=e,this.realtimeIsOn()?(this.page.id&&(this.views.comments_options.updateToggle("connected",t),this.updateFilterID(s.subscribe({page_uuid:[n.toUuid(this.page.id)],event_type:["comment"]}))),t&&_.fetchShare({page:this.page}).done(this.showSharedComment.bind(this)).fail(this.changeCommentSort("newest")),this.isShare||i!==!0||this.getNewRTCommentCount()):(this.updateFilterID(void 0),s.unsubscribe(this.filter_id),this.views.comments_options.updateToggle("disconnected"))},updateHasRealtime:function(e){this.hasRealtime=e,t.each(this.views,function(t){t.hasRealtime=e}),this.views.comments.updateHasRealtime(e)},getNewRTCommentCount:function(){if(this.collection.before_id){var e=this.collection,i=t.clone(e.settings,!0),s=e.before_id;e.settings.limit=1,e.fetchPageBefore({add:!1,remove:!1,silent:!0,setCounts:!1,setBeforeAfterIDs:!1,success:function(e,t){var i=t.result.results.length,s=t.result.before_count-this.numCommentsMade+i;this.views.comments_options.realtimeReset(),this.views.comments_options.realtimeIncrement(s),this.onCommentsSuccess()}.bind(this)}),e.settings=i,e.before_id=s}},handleThrottleEvent:function(e){"active"!==e&&"inactive"!==e||this.realtimeToggle(this.rtToggledOn,!1,!0)},updateFilterID:function(e){this.filter_id=e,t.each(this.views,function(t){t.filter_id=e}),this.views.comments.updateFilterID(e)},checkScrollDown:function(){if(window.location.hash.match(/^#vf-commenting-widget$/)){var t=e(".vf-widget.vf-comments").first();if(t.length>0){var i=t.offset();e(window).scrollTop(i.top)}}},realtimeUpdate:function(e){if(!this.isShare&&this.filter_id&&e.filter_id&&e.filter_id===this.filter_id&&"comment.enable"===e.event_type){var t=n.toVfId(e.comment_uuid);this.isSelf(e,this.currentUser)||e.comment_uuid!==e.thread_uuid||this.realtimeIDs.push(t)}}});return w}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},73:function(e,t,i){var s,n;try{s=[i(9),i(63),i(10),i(3),i(74)],n=function(e,t,i,s,n){var o=t.extend({templateName:"login_dashboard",tagName:"div",className:"vf-login-widget vf-clearfix",events:{"click .vf-login-button":"login","click .vf-logout":"logout","click .vf-logout-disable":"onDisableLogout","click .vf-signup-button":"register","click .vf-username":"userClick"},initialize:function(e){this.model=e.user,this.settings=e.settings,this.listenTo(this.model,"change:id change:name",this.render),this.listenTo(this.model,"change:id change:username_pending",this.render),this.listenTo(i,"/user/login/social/fail",this.loginError),this.listenTo(i,"/user/login/social/error",this.loginError),this.listenTo(i,"/user/login/social/cancel",this.hideDisable)},render:function(){var e;return this.model.isLoggedIn()||0!==this.settings.get("authprovider_viafoura_enabled")?(this.templateName="login_dashboard",e=this.model.toJSON(),e.username_moderation_status&&e.username_moderation_status.match(/pending/gi)?e.username_moderation_status="pending":this.model.isLoggedIn()&&"approved"!==e.username_moderation_status&&e.username_moderation_status||(e.username_moderation_status="approved"),e.name=e.username_pending||e.name,e.alert_msg="name_"+e.username_moderation_status+"_alert",e.has_usermod=this.model.hasUserModeration(),this.templateOnly(e),e.has_usermod&&this.$(".vf-js-needs-moderation").length>0&&this.initModerationTooltip("name",e.username_moderation_status)):(this.templateName="social_logins",e=this.settings.toJSON(),this.templateOnly(e)),this},loginError:function(e){this.isDisabled()&&(this.hideDisable(),this.trigger("login:error",e))},login:function(e){e.preventDefault(),e.stopPropagation(),i.trigger("/user/login/click")},logout:function(e){e.preventDefault(),e.stopPropagation(),i.trigger("/user/logout/click"),i.trigger("/modal/close")},register:function(e){e.preventDefault(),e.stopPropagation(),i.trigger("/user/signup/click")},userClick:function(e){e.preventDefault(),e.stopPropagation();var t;this.model.hasUnapprovedUsername()&&(t={name:"settings",focus:"vf_name"}),i.trigger("/user/account/click",this.model,t)},onDisableLogout:function(e){e.preventDefault()},initModerationTooltip:function(e,t){var i=e+"_"+t;this.$(".vf-js-user-mod-icon").css({cursor:"pointer"}).tipsy({title:i+"_tip",gravity:"n",delayIn:100,delayOut:100})}});return e.extend(o.prototype,n.methods),e.extend(o.prototype.events,n.events),o}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},75:function(e,t,i){var s,n;try{s=[i(12),i(9),i(10),i(63)],n=function(e,t,i,s){var n=s.extend({templateName:"page_settings",events:{"change .vf-thread-option":"changePageSettings","change .vf-smartmod-option":"changePageSMSettings","change .vf-premod-option":"changePageSMSettings"},initialize:function(e){t.bindAll(this,"changePageSettings","changePageSMSettings"),this.page=e.page,this.model=e.page},render:function(){var e=this.model.toJSON();return e.moderation_smartmod_enabled=1===this.domainSettings.get("moderation_smartmod_enabled"),this.templateOnly(e),this.initToggles(),this.togglePremod(this.pageSmartmodOn(),"enable_premod_unknown"===this.model.get("smartmod")),this.toggleSmartmod(this.pageSmartmodOn()),this},pageSmartmodOn:function(e){return e=e||this.model.get("smartmod"),"disable"!==e&&1===this.domainSettings.get("moderation_smartmod_enabled")},changePageSettings:function(t){var i=e(t.target),s=i.val();this.model.save({status:s})},getSmartmodFromButtons:function(){return this.getSmartmodSettingText(this.$el.smartmod_option.is(":checked"),this.$el.premod_option.is(":checked"))},getSmartmodSettingText:function(e,t){return e?t?"enable_premod_unknown":"enable":"disable"},changePageSMSettings:function(){var e=this.getSmartmodFromButtons();this.model.save({smartmod:e,status:this.model.get("status")}),this.toggleSmartmod("disable"!==e),this.togglePremod(this.pageSmartmodOn(e),"enable_premod_unknown"===e)},initToggles:function(){this.$el.page_setting_tooltip=this.$el.find(".vf-page-settings-tooltip"),this.$el.smartmod_toggle=this.$el.find(".vf-smartmod-toggle"),this.$el.smartmod_option=this.$el.find(".vf-smartmod-option"),this.$el.premod_setting=this.$el.find(".vf-premod-setting"),this.$el.premod_option=this.$el.find(".vf-premod-option")},toggleSmartmod:function(e){var t;this.$el.find(".vf-thread-option").prop("disabled",e),e?(t="enable",this.$el.page_setting_tooltip.show()):(t="disable",this.$el.page_setting_tooltip.hide().tipsy("remove")),this.$el.smartmod_toggle.attr("data-title","smartmod-toggle-"+t),this.$el.smartmod_toggle.find(".vf-switch").text(this.i18n("toggle_"+t)),this.$el.smartmod_toggle.tipsy("hide")},togglePremod:function(e,t){this.$el.premod_setting.toggle(e);var i=t?"toggle_enable":"toggle_disable";this.$el.premod_setting.find(".vf-switch").text(this.i18n(i)),t||this.$el.premod_option.attr("checked",!1)}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},76:function(e,t,i){var s,n;try{s=[i(9),i(12),i(63),i(10),i(77),i(78)],n=function(e,t,i,s,n,o){var r=i.extend({templateName:"reply_box",events:{"keyup .vf-content":"cacheComment"},initialize:function(e){this.section=e.section,this.user=e.user,this.page=e.page,this.comment=e.comment,this.settings=e.settings,this.prefix=e.prefix||"",this.text=e.text,this.views={avatar:new n({user:this.user}),comment_form:new o({section:this.section,model:this.page||this.comment,settings:this.settings,text:this.prefix,loginDashboard:e.loginDashboard})},this.listenTo(this.views.comment_form,"comment:submitted",this.commentSubmitted)},commentSubmitted:function(e){this.trigger("comment:submitted",e)},isCommentReply:function(){return!!this.comment},render:function(e){return this.cacheSave(this.$("textarea")),this.templateOnly(),this.insertSubViews(this.views),this.text&&(this.$(".vf-content").val(this.text),this.text=!1,this.views.comment_form.revalidateTextarea()),this.cacheRestore(),this},cacheComment:function(e){this.comment&&s.trigger("/commenting/reply/save",this.$("textarea").val(),this.comment.id),this.cacheSave(this.$("textarea"))}});return r}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},77:function(e,t,i){var s,n;try{s=[i(12),i(9),i(11),i(63),i(10),i(3)],n=function(e,t,i,s,n,o){return s.extend({templateName:"avatar",events:{"click .vf-avatar":"showAccountProfile"},initialize:function(e){this.model=e.user,this.listenTo(this.model,"change:pic_small change:pic_small_pending",this.render),this.listenTo(o.events,"/user/login/success",this.render)},render:function(e){var t=this.model.toJSON(),i=o.current.user;t.hasAvatarMod=(!e||!e.isComment)&&this.model.hasAvatarModeration()&&this.model.id===i.id,t.avatar_moderation_status&&t.avatar_moderation_status.match(/pending/gi)?(t.avatar_moderation_status="pending",t.pic_small=t.pic_small_pending||t.pic_small,t.pic_large=t.pic_large_pending||t.pic_large):this.model.isLoggedIn()&&"approved"!==t.avatar_moderation_status&&t.avatar_moderation_status?"rejected"===t.avatar_moderation_status&&(t.pic_small=t.pic_small_pending||t.pic_small,t.pic_large=t.pic_large_pending||t.pic_large):t.avatar_moderation_status="approved","approved"!==t.avatar_moderation_status?t.alert_msg=o.i18n.translate("avatar_"+t.avatar_moderation_status+"_tip"):(this.model.hasUnapprovedUsername()&&(t.name=t.username_pending),t.alert_msg=t.name),this.templateOnly(t),(this.model!=i&&this.model.isGuest()||this.model===i&&this.model.canAnonymouslyPost())&&(this.$el.addClass("vf-is-anonymous"),this.$el.undelegate(".vf-avatar","click")),this.$(".vf-avatar").attr("onerror","this.src='"+this.model.defaults.pic_small+"'"),t.hasAvatarMod&&this.initModerationTooltip(t.avatar_moderation_status)},showAccountProfile:function(e){e.preventDefault(),e.stopPropagation(),this.model.id?n.trigger("/user/account/click",this.model):n.trigger("onLoginRequired")},initModerationTooltip:function(e){var t="avatar_"+e;this.$(".vf-js-user-mod-icon").css({cursor:"pointer"}).tipsy({title:t+"_tip",gravity:"n",delayIn:100,delayOut:100})}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},78:function(e,t,i){var s,n;(function(o){try{s=[i(12),i(9),i(11),i(63),i(79),i(3),i(10),i(33),i(73),i(81),i(18),i(84),i(85),i(86),i(87),i(88),i(83),i(15)],n=function(e,t,i,s,n,r,a,l,h,c,d,m,u,p,f,g,v,_){var w=s.extend({mixins:[f,m,p,g],templateName:"comment_form",events:{"click .vf-progress-cancel":"cancelUpload","click .vf-comment-submit":"submitForm","click .vf-upload-image":"onUploadImage","click .vf-upload-video":"onUploadVideo","change .vf-video-file":"uploadFile","change .vf-image-file":"uploadFile","keydown .vf-comment-textarea":"onTextChange","change .vf-comment-textarea":"onTextChange","input .vf-comment-textarea":"onTextChange","keyup .vf-comment-textarea":"onKeyUp","paste .vf-comment-textarea":"onPaste","textInput .vf-comment-textarea":"onTextChange"},initialize:function(e){this.forceEncodeCount=d.getIEVersion()&&d.getIEVersion()<=9,this.user=r.current.user,this.settings=e.settings,this.forcedDisabled=!1,this.original_text=e.text||"",this.section=e.section,this.maxCharacters=this.settings.get("comment_max_length"),this.showCharacterCount=this.maxCharacters-100,this.commentLimitEnabled=1===this.domainSettings.get("enable_email_verification")||1===this.domainSettings.get("enable_username_premoderation"),this.views={login_dashboard:new h({user:this.user,settings:this.settings})},this.loginDashboard=e.loginDashboard||this.views.login_dashboard,this.listenTo(this.loginDashboard,"login:error",this.loginError),this.listenTo(this.user,"change:id",this.onUserLogin),this.listenTo(this.user,"change:email_pending change:username_pending change:avatar_moderation_status",this.toggleModeration.bind(this)),a.on("comment:created",this.checkCommentLimit.bind(this))},render:function(){return this.templateOnly({enable_video_upload:r.current.settings.get("enable_comment_video"),enable_image_upload:r.current.settings.get("enable_comment_images"),enable_anonymous_comments:r.current.settings.get("enable_anonymous_comments"),hasVerification:this.domainSettings.get("enable_email_verification")||this.domainSettings.get("enable_username_premoderation")}),this.$progressBar=this.$(".vf-progress-bar"),this.$progress=this.$progressBar.find(".vf-progress"),this.$filename=this.$progressBar.find(".vf-progress-filename"),this.$submitButton=this.$(".vf-comment-submit"),this.$textarea=this.$("textarea"),this.views.verification_status=new c({model:this.user,domain:this.locations.domain,templateName:"moderation_status"}),this.toggleModeration(),this.$textarea.val(this.original_text),this.onUserLogin(),this.clearUpload(),this},revalidateTextarea:function(){this.$(".vf-content").keyup()},onPaste:function(e){var t=this;o(function(){t.onTextChange(e)},0),this.onCharacterChange(e)},onUserLogin:function(){var e=r.current.user.isLoggedIn();this.$(".vf-anonymous-menu").toggle(!e),this.$(".vf-image-file, .vf-video-file").toggle(e),this.removeMessages(),e||this.clearUpload()},clear:function(){this.$("textarea").val(""),this.$("textarea").css("height",""),this.$("textarea").parent().css("height",""),this.clearUpload()},clearUpload:function(){if(this.enableSubmit(),this.$progressBar){this.$progressBar.hide(),delete this.mediaId,delete this.uploading;var e=this.$(".vf-image-file"),t=this.$(".vf-video-file");e.replaceWith(e.clone(!0)),t.replaceWith(t.clone(!0))}},onTextChange:function(t){t&&t.ctrlKey&&13===t.keyCode&&"keydown"===t.type&&this.submitForm(t);var i=e(t.target);this.cacheSave(this.$("textarea")),this.resizeTextarea(i)},onKeyUp:function(e){this.onTextChange(e),this.onCharacterChange(e)},onCharacterChange:function(t){if(!this.submittingComment){var i=e(t.target).val();this.countCharacters(i,this.showCharacterCount,this.maxCharacters,this.$(".vf-char-count"),this.$(".vf-tipsy-mask"))?this.disableSubmit(!0):this.enableSubmit(!0)}},getFormData:function(){var e={};return e.content=this.$(".vf-content").val(),e.anonymous_name=this.$("[name=vf_anonymous_name]").val(),this.mediaId&&(e.media_id=this.mediaId),e.parent_id=this.model.id,e},submitForm:function(t){t.preventDefault();var i=this.getFormData();i.content=u.cleanString(i.content);var s=new l(i);if(this.$(".vf-error-box").empty(),this.authorize("create",s)){if(this.validateComment(s,this.maxCharacters,this.original_text)){this.$(".vf-error-message, .vf-char-count").empty(),r.current.user.isLoggedIn()?delete i.anonymous_name:r.current.user.set("name",i.anonymous_name);var n=this;e.fn.loader.hideErrors(),this.$(".vf-comment-submit-wrap").loader("show",{gifType:"gray"}),this.canSubmit&&(this.disableSubmit(),s.save(i,{success:function(e){n.clear(),n.enableSubmit();var t=new l(e.result);n.user.set("comments_made",n.user.get("comments_made")+1),a.trigger("comment:created",t),n.trigger("comment:submitted",t),n.submittingComment=!1,n.$(".vf-comment-submit-wrap").loader("hide")},error:function(e){n.enableSubmit(),n.submittingComment=!1,n.$(".vf-comment-submit-wrap").loader("hide"),n.displayError(n.getErrorMessage(e))},xhr:!this.forceEncodeCount}),this.submittingComment=!0)}else this.displayError(this.commentError);return this}},loginError:function(e){this.displayError(e)},uploadFile:function(t){this.clearUpload(),this.disableSubmit(),this.upload=new n({restAPI:this.restAPI,file:e(t.target),type:"media",session:r.current.session.id,section:this.section}),this.listenTo(this.upload,"progress",this.updateProgress),this.listenTo(this.upload,"done",this.updateProgress),this.listenTo(this.upload,"media",this.attachMedia),this.listenTo(this.upload,"error",this.uploadError),this.upload.upload()},cancelUpload:function(e){e&&e.preventDefault(),this.$(".vf-error-box").empty(),this.upload&&(this.upload.cancel(),this.stopListening(this.upload),delete this.upload),this.clearUpload()},attachMedia:function(e,t){this.mediaId=e.id||e.attributes.t&&e.attributes.t.id,_.assert(void 0!==this.upload,"Upload undefined"),this.stopListening(this.upload),delete this.upload,this.enableSubmit(),this.updateProgressBar("100%",100,!0),e.isVideo()?this.displaySuccess(this.i18n("video_uploaded_successfully")):e.isImage()&&this.displaySuccess(this.i18n("image_uploaded_successfully"))},uploadError:function(e){this.displayError(this.i18n(v.uploadStatusToI18n(e.status||e.http_status))),_.assert(void 0!==this.upload,"Upload undefined"),this.stopListening(this.upload),delete this.upload,this.clearUpload()},updateProgress:function(e){var t=e.state,i=0;"uploading"===t?(this.uploading=!0,i=Math.min(Math.floor(e.received/e.size*100),99)):"done"===t&&(delete this.uploading,i=99),this.updateProgressBar(i+"%",i,!!i)},updateProgressBar:function(e,t,i){this.$progressBar.toggle(i),this.$filename.text(e),this.$progress.css("width",t+"%")},displayError:function(e){this.$(".vf-error-box").html(this.inlineError(e)),a.trigger("/commenting/resize")},displaySuccess:function(e){this.$(".vf-error-box").html(this.inlineSuccess(e))},disableSubmit:function(e){!this.$submitButton||this.forcedDisabled!==!1&&e!==!0||(this.canSubmit=!1,this.$submitButton.attr("disabled",!0),this.$(".vf-tipsy-mask").show(),this.forcedDisabled=!!e)},enableSubmit:function(e){!this.$submitButton||this.forcedDisabled!==!1&&e!==!0||(this.canSubmit=!0,this.forcedDisabled=!1,this.$submitButton.removeAttr("disabled"),this.$(".vf-tipsy-mask").hide())},selectImageFile:function(e){e.preventDefault(),this.authorize("uploadImage")&&this.$(".vf-image-file").trigger("click")},selectVideoFile:function(e){e.preventDefault(),this.authorize("uploadVideo")&&this.$(".vf-video-file").trigger("click")},onUploadImage:function(){this.authorize("uploadImage")},onUploadVideo:function(){this.authorize("uploadVideo")},toggleModeration:function(){this.user.isLoggedIn()&&(this.user.hasUnverifiedEmail()||this.user.hasUnapprovedUsername()||this.user.hasUnapprovedAvatar())?(this.views.verification_status.type="email",this.user.hasUnverifiedEmail()?(this.views.verification_status.message=r.i18n.translate("verification_required",this.user.get("email_pending")),this.views.verification_status.warning=!1,this.closeComments(!1),this.user.hasUpdatedEmail()?this.views.verification_status.message=r.i18n.translate("verify_email_update",this.user.get("email_pending")):this.user.hasCommentLimit()&&(this.views.verification_status.message=r.i18n.translate("block_comments_until_verified",this.user.get("email_pending")),this.views.verification_status.warning=!0,this.closeComments(!0))):this.user.hasUnapprovedUsername()?(this.views.verification_status.type="username",this.user.hasPendingUsername()||this.user.hasNewUsername()?(this.views.verification_status.message=r.i18n.translate("user_name_awaiting_approval"),this.views.verification_status.warning=!1):this.user.hasRejectedUsername()&&(this.views.verification_status.message=this.user.get("name")?r.i18n.translate("name_rejected_tip"):r.i18n.translate("name_rejected_alert",this.user.get("username_pending")),this.views.verification_status.warning=!0)):(this.views.verification_status.type="avatar",this.user.hasPendingAvatar()?(this.views.verification_status.message=r.i18n.translate("avatar_awaiting_approval"),this.views.verification_status.warning=!1):(this.views.verification_status.message=r.i18n.translate(this.user.get("pic_small")==this.user.defaults.pic_small?"avatar_rejected_default":"avatar_rejected"),this.views.verification_status.warning=!0)),this.$('div[data-view="verification_status"]').length>0?this.insertSubViews({verification_status:this.views.verification_status}):(this.$(".vf-verification-status").replaceWith(this.views.verification_status.el),this.views.verification_status.render())):(this.$(".vf-verification-status").empty(),this.closeComments(!1))},checkCommentLimit:function(){this.commentLimitEnabled&&this.user.hasCommentLimit()&&this.toggleModeration()},closeComments:function(e){this.$("textarea").attr("disabled",e),e?this.disableSubmit(!0):this.enableSubmit(!0),this.$(".vf-upload-image").attr("disabled",e),this.$(".vf-upload-video").attr("disabled",e),this.$(".vf-upload-item input").attr("disabled",e)}});return w}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},79:function(e,t,i){var s,n;(function(o){try{s=[i(12),i(9),i(11),i(64),i(3),i(80),i(20),i(7)],n=function(e,t,i,s,n,r,a,l){var h=function(){this.setup.apply(this,arguments)};return t.extend(h.prototype,i.Events,{setup:function(t){this.restAPI=t.restAPI,this.paths={media:l.api_url+n.locations.domain+"/media",avatar:l.api_url+n.locations.domain+"/users/"+n.current.user.id},t&&"object"==typeof t&&(this.file=t.file,
e(t.file).replaceWith(e(t.file).clone()),this.type=t.type||"media",this.section=t.section,this.session=t.session||n.current.session.id,this.domain=t.domain||n.locations.domain),this.progressKey="X-Progress-ID",this.progressId=this.generateUID(),this.progress=0,this.state="init",this.delay=500},generateUID:function(){return("1"+Math.random()).replace(".","0")},getUploadUrl:function(e){var t=this.paths[e]+"?"+this.progressKey+"="+this.progressId+"&session="+this.session+"&mime=text%2Fhtml";return"avatar"===this.type&&(t+="&verb=patch"),this.section&&(t+="&section="+this.section),t},upload:function(){var t,i,n=this;this._cancel=!1,t=e(s("iframe_upload")({url:this.getUploadUrl(this.type),target:"vf"+e.now()})),i=t.find("iframe"),i.on("load",function(){i.off("load"),n._cancel||t.submit()}),t.append(this.file),e("body").append(t),this.poll()},poll:function(){var e=this;this.restAPI.trackUpload(this.progressId,{success:function(t){if(e._cancel)return e.state="cancel",void e.trigger(this.state);if(t.id=e.progressId,"error"===t.state||"undefined"==typeof t.state)return e.state="error",void e.trigger("error",t);if("done"===t.state){e.state="done",e.trigger("done",t);var i=r;i.fetch(t.id,function(t,i){e.trigger("media",t,i)},function(t){e.trigger("error",t)})}else"uploading"===t.state&&(e.state="uploading",e.trigger("progress",t));"done"!==e.state&&o(function(){e.poll()},e.delay)}})},cancel:function(){this._cancel=!0},getProgress:function(){return this.progress}}),h}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},80:function(e,t,i){var s,n;try{s=[i(27)],n=function(e){var t=e.extend({url:"/media",isImage:function(){return this.has("m")||this.has("t")||this.has("s")},isVideo:function(){return this.has("mp4_status")}},{fetch:function(e,i,s,n){var o=new t({xpid:e});return o.fetch({params:!0,success:function(e,t){"OK"==t.message?i&&i.call(n,o,t):s&&s.call(n,t)},error:function(e,t){s&&s.call(n,t)}}),o}});return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},81:function(e,t,i){var s,n;try{s=[i(9),i(3),i(10),i(23),i(63),i(82)],n=function(e,t,i,s,n,o){return n.extend(o).extend({templateName:"verification_status",className:"vf-email-verification",events:{"click .vf-open-modal-profile":"showEmailSettings","click .vf-resend-verification-email":"resendVerification"},initialize:function(t){e.bindAll(this,"showEmailSettings","resendVerification"),t.templateName&&(this.templateName=t.templateName),this.message=t.message,this.warning=t.warning||!1},render:function(){var t=e.extend(this.model.toJSON(),this.options.data||{});t.message=this.message,t.domain=this.options.domain,t.type=this.type,t.warning=this.warning,this.templateOnly(t)},showEmailSettings:function(e){e.preventDefault(),e.stopPropagation(),i.trigger("/user/account/click",this.model,{name:"settings",focus:e.target.getAttribute("data-focus")||"vf_name"}),this.$("a").attr({"aria-expanded":!0,id:"modal-open"})}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},82:function(e,t,i){var s,n;(function(o){try{s=[i(12),i(10),i(23),i(83)],n=function(e,t,i,s){return{resendVerification:function(n){n.preventDefault();var o=this;o.resetStatus(e(".vf-resend-verification-status"));var r=o.$(".vf-resend-verification-status");r.attr("aria-hidden",!1).loader("show"),t.trigger("/user/email_verification/resend",null,{resend_verification:!0,success:function(e){o.displayResendStatus("success",r)},error:function(e){var t=null;e.api_code&&(t=i.translate(s.codeToI18n(e.api_code).shift())),o.displayResendStatus("error",r,t)}})},resetStatus:function(e){e.attr("aria-hidden",!0),e.find(".vf-moderation-status-icon").removeClass("vf-icon-success, vf-icon-error").addClass("hidden"),e.find("strong").text("")},displayResendStatus:function(e,t,s){o(function(){t.loader("hide"),t.find(".vf-moderation-status-icon").removeClass("hidden").addClass("vf-icon-"+e),t.find("strong").text(s||i.translate("resend_verification_"+e))},1e3)}}}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},84:function(e,t,i){var s,n;try{s=[i(85)],n=function(e){var t={validateComment:function(t,i,s){delete this.commentError;var n=e.cleanString(t.get("content").replace(s,""));return""!==n||t.hasMedia()?!(n.length>i)||(this.commentError=this.i18n("verror_maxLength",i),!1):(this.commentError=this.i18n("verror_empty"),!1)}};return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},85:function(e,t,i){var s,n;try{s=[i(12)],n=function(e){return{cleanString:function(e){return e&&"string"==typeof e?this.condense(this.trim(e)):""},trim:function(t){return e.trim(t)},condense:function(e){return e.replace(/\n\s*\n/g,"\n\n")}}}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},86:function(e,t,i){var s,n;try{s=[],n=function(){var e={resizeTextarea:function(e){var t=e.outerHeight(),i=e[0].scrollHeight;i>t&&(e.parent().css({height:i+"px"}),e.css({height:i+"px"}))},resizeWithLimit:function(e,t,i){var s=e[0].scrollHeight;s>i?e.css({height:i+"px",overflow:"auto"}):(e.height(0),s=e[0].scrollHeight,s<t?e.css({height:t+"px",overflow:"hidden"}):e.css({height:s+"px",overflow:"hidden"}))}};return e}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},87:function(e,t,i){var s,n;try{s=[i(18)],n=function(e){var t={countCharacters:function(t,i,s,n,o){var r;if(r=e.supportCORS()||e.supportXDomain()&&!this.forceEncodeCount?t.length:encodeURIComponent(t).length,r>=i){if(n.text(s-r).show(),r>s)return n.removeClass("char-near-limit").addClass("char-over-limit"),o.tipsy({template:"charcounter",title:"over-char-limit",gravity:"ne"}),!0;o.tipsy("remove"),r>=s-50?n.removeClass("char-over-limit").addClass("char-near-limit"):n.removeClass("char-near-limit char-over-limit")}else n.empty().hide(),o.tipsy("remove");return!1}};return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},89:function(e,t,i){var s,n;try{s=[i(9),i(12),i(91),i(63),i(72),i(70),i(90),i(3),i(18),i(50)],n=function(e,t,i,s,n,o,r,a,l,h){var c=s.extend({templateName:"comments_options",mixins:[o,r],new_comments:0,new_comments_counter_limit:10,waypoint:null,events:{"change .vf-comments-sort":"changeSortOption","click .vf-subscribe":"follow","click .vf-comments-realtime":"loadNewest","click .vf-rt-toggle":"realtimeToggle","touchstart .vf-rt-main-static":"touchstartStatic","touchend .vf-rt-main-static":"touchendStatic","touchstart .vf-rt-main-sticky":"touchstartSticky","touchend .vf-rt-main-sticky":"touchendSticky"},initialize:function(t){this.isShare=!1,e.bindAll(this,"onError","onSuccess","waypointHandler"),this.settings=t.settings,t.hasRealtime&&(this.listenTo(h,"content",this.realtimeUpdate),this.listenTo(h,"status",this.updateToggle)),this.viewVars={hasRealtime:t.hasRealtime}},render:function(){this.templateOnly(e.defaults(this.viewVars,this.model.toJSON())),this.$sort=this.$(".vf-comments-sort"),this.$toggle=this.$(".vf-rt-toggle");var t=this.options.sort||this.settings.get("commenting_sort");return this.$sort.val(t),this.settings.get("disable_email_notifications")&&this.$(".vf-subscribe").hide(),this.settings.get("enable_comment_sorting",!0)||this.$(".vf-comments-sort-block").hide(),this.listenTo(this.model,"change:subscribed",this.followChanged),l.isTouch()&&this.initializeTouchEvents(),this},changeSortOption:function(e){var t=this.currentSortOption();"string"==typeof e&&e!==t&&(this.$sort.val(e),t=e),this.trigger("change:sort",t)},currentSortOption:function(){return this.$sort.val()},follow:function(e){e.preventDefault(),this.authorize("follow",this.model)&&(t.fn.loader.hideErrors(),this.model.toggleFollow({success:this.onSuccess,error:this.onError}),this.$(".vf-subscribe").loader("show",{position:"right"}))},onSuccess:function(){this.$(".vf-subscribe").loader("hide")},onError:function(){this.$(".vf-subscribe").loader("error",{position:"right"}).tipsy({title:"something_went_wrong",interactive:!0})},followChanged:function(e,t){t?this.$(".vf-subscribe").text(this.i18n("unsubscribe_btn")).attr("data-title","unsubscribe-page"):this.$(".vf-subscribe").text(this.i18n("subscribe_btn")).attr("data-title","subscribe-page")},realtimeUpdate:function(e){e&&this.filter_id&&this.filter_id===e.filter_id&&!this.isShare&&"comment.enable"===e.event_type&&e.thread_uuid&&(this.isSelf(e,a.current.user)||this.trigger("visible",l.toVfId(e.thread_uuid),function(t){t||e.comment_uuid!==e.thread_uuid||this.realtimeIncrement(1)}.bind(this)))},initSticky:function(){if(this.new_comments<1)return this.waypointHandler("up"),i.destroyAll(),void(this.waypoint&&(this.waypoint.destroy(),this.waypoint=null));if(!this.waypoint){var s=this.$(".vf-rt-main-sticky"),n=this.$(".vf-rt-main-static"),o=n.width(),r=n.offset().left;o&&s.width(o),r&&s.offset({left:r}),t(window).resize(e.debounce(function(){o=n.width(),r=n.offset().left,o&&s.width(o),r&&s.offset({left:r})},150).bind(this)),this.waypoint=new i({element:this.$(".vf-rt-main-static")[0],offset:-30,enabled:!0,handler:this.waypointHandler})}},initializeTouchEvents:function(){var e=this.$(".vf-rt-main-static .vf-rt-hover-state"),t=this.$(".vf-rt-main-sticky .vf-rt-hover-state");this.rt_static={$el:e,heightDefault:e.height(),heightOnHover:this.$(".vf-rt-main-static").height(),transition:e.css("transition")},this.rt_sticky={$el:t,heightDefault:t.height(),heightOnHover:this.$(".vf-rt-main-sticky").height(),transition:t.css("transition")}},touchstartStatic:function(e){r.renderHoverStyles(e,this.rt_static.$el,this.rt_static.heightOnHover,this.rt_static.transition)},touchendStatic:function(e){r.removeHoverStyles(e,this.rt_static.$el,this.rt_static.heightDefault,this.rt_static.transition),this.loadNewest(e)},touchstartSticky:function(e){r.renderHoverStyles(e,this.rt_sticky.$el,this.rt_sticky.heightOnHover,this.rt_sticky.transition)},touchendSticky:function(e){r.removeHoverStyles(e,this.rt_sticky.$el,this.rt_sticky.heightDefault,this.rt_sticky.sticky_transition),this.loadNewest(e)},waypointHandler:function(e){var t=this.$(".vf-rt-main-sticky");"down"===e?t.addClass("stuck vf-rt-sliding").one("transitionend webkitTransitionEnd",function(){t.removeClass("vf-rt-sliding")}):"up"===e&&t.removeClass("stuck vf-rt-sliding")},loadNewest:function(e){e.preventDefault(),l.isElementPartiallyInViewport(this.$el)||t(window).scrollTop(this.$el.offset().top);var i=this.currentSortOption();"newest"!==i?this.changeSortOption("newest"):this.trigger("fetch")},realtimeIncrement:function(e){this.new_comments+=e,this.new_comments<0&&(this.new_comments=0),this.initSticky(),this.renderCounter()},realtimeReset:function(){this.new_comments=0,this.initSticky(),this.renderCounter()},renderCounter:function(){this.new_comments&&(this.$(".vf-rt-label").html(this.i18n("newest"===this.currentSortOption()?"realtime_new_comments":"realtime_new_comments_switch",this.new_comments,this.new_comments_counter_limit)),this.$(".vf-rt-bubble-text").html(this.new_comments<=this.new_comments_counter_limit?this.new_comments:this.new_comments_counter_limit+"+")),this.$(".vf-rt-bubble-text").toggleClass("vf-rt-over-limit",this.new_comments>this.new_comments_counter_limit),this.$(".vf-rt-main-static").toggleClass("invisible",0===this.new_comments)},updateToggle:function(e,t){if("unsupported"===e)return void this.$toggle.hide();"connected"===e&&t&&this.$sort.val("newest"),this.$toggle.toggleClass("active vf-rt-accent-color-background","connected"===e).toggleClass("connecting","connecting"===e).find(".vf-rt-toggle-dot").toggleClass("vf-rt-main-color-background","connected"===e);var i="connecting"===e?"realtime_connecting":"realtime_on";this.$toggle.find("span").html(this.i18n(i)),this.$toggle.tipsy("hide"),this.$toggle.attr("data-title","connected"===e?"realtime-toggle-on":"realtime-toggle-off")},realtimeToggle:function(){var e=!this.$toggle.hasClass("active");this.trigger("realtime-toggle",e,!0)},updateHasRealtime:function(t){this.hasRealtime=t,e.each(this.views,function(e){e.hasRealtime=t})}});return c}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},90:function(e,t,i){var s,n;try{s=[i(12),i(18)],n=function(e,t){var i={renderHoverStyles:function(e,t,i,s){e.preventDefault(),t.css({"-webkit-transition":s,"-moz-transition":s,"-ms-transition":s,"-o-transition":s,transition:s,height:i,top:0})},removeHoverStyles:function(e,t,i,s){e.preventDefault(),t.css({"-webkit-transition":s,"-moz-transition":s,"-ms-transition":s,"-o-transition":s,transition:s,height:i,top:"100%"})}};return i}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},91:function(e,t,i){var s,n;(function(o){s=[i(12)],n=function(e){var t={$:e};return function(){"use strict";function e(t){if(!t)throw new Error("No options passed to Waypoint constructor");if(!t.element)throw new Error("No element option passed to Waypoint constructor");if(!t.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+i,this.options=e.Adapter.extend({},e.defaults,t),this.element=this.options.element,this.adapter=new e.Adapter(this.element),this.callback=t.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=e.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=e.Context.findOrCreateByElement(this.options.context),e.offsetAliases[this.options.offset]&&(this.options.offset=e.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),s[this.key]=this,i+=1}var i=0,s={};e.prototype.queueTrigger=function(e){this.group.queueTrigger(this,e)},e.prototype.trigger=function(e){this.enabled&&this.callback&&this.callback.apply(this,e)},e.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete s[this.key]},e.prototype.disable=function(){return this.enabled=!1,this},e.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},e.prototype.next=function(){return this.group.next(this)},e.prototype.previous=function(){return this.group.previous(this)},e.destroyAll=function(){var e=[];for(var t in s)e.push(s[t]);for(var i=0,n=e.length;i<n;i++)e[i].destroy()},e.refreshAll=function(){e.Context.refreshAll()},e.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},e.viewportWidth=function(){return document.documentElement.clientWidth},e.adapters=[],e.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},e.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},t.Waypoint=e}(),function(){"use strict";function e(e){o(e,1e3/60)}function i(e){this.element=e,this.Adapter=r.Adapter,this.adapter=new this.Adapter(e),this.key="waypoint-context-"+s,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},e.waypointContextKey=this.key,n[e.waypointContextKey]=this,s+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}var s=0,n={},r=t.Waypoint,a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||e,l=window.onload;i.prototype.add=function(e){var t=e.options.horizontal?"horizontal":"vertical";this.waypoints[t][e.key]=e,this.refresh()},i.prototype.checkEmpty=function(){var e=this.Adapter.isEmptyObject(this.waypoints.horizontal),t=this.Adapter.isEmptyObject(this.waypoints.vertical);e&&t&&(this.adapter.off(".waypoints"),delete n[this.key])},i.prototype.createThrottledResizeHandler=function(){function e(){t.handleResize(),t.didResize=!1}var t=this;this.adapter.on("resize.waypoints",function(){t.didResize||(t.didResize=!0,a(e))})},i.prototype.createThrottledScrollHandler=function(){function e(){t.handleScroll(),t.didScroll=!1}var t=this;this.adapter.on("scroll.waypoints",function(){t.didScroll&&!r.isTouch||(t.didScroll=!0,a(e))})},i.prototype.handleResize=function(){r.Context.refreshAll()},i.prototype.handleScroll=function(){var e={},t={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in t){var s=t[i],n=s.newScroll>s.oldScroll,o=n?s.forward:s.backward;for(var r in this.waypoints[i]){var a=this.waypoints[i][r],l=s.oldScroll<a.triggerPoint,h=s.newScroll>=a.triggerPoint,c=l&&h,d=!l&&!h;(c||d)&&(a.queueTrigger(o),e[a.group.id]=a.group)}}for(var m in e)e[m].flushTriggers();this.oldScroll={x:t.horizontal.newScroll,y:t.vertical.newScroll}},i.prototype.innerHeight=function(){return this.element===this.element.window?r.viewportHeight():this.adapter.innerHeight()},i.prototype.remove=function(e){delete this.waypoints[e.axis][e.key],this.checkEmpty()},i.prototype.innerWidth=function(){return this.element===this.element.window?r.viewportWidth():this.adapter.innerWidth()},i.prototype.destroy=function(){var e=[];for(var t in this.waypoints)for(var i in this.waypoints[t])e.push(this.waypoints[t][i]);for(var s=0,n=e.length;s<n;s++)e[s].destroy()},i.prototype.refresh=function(){var e,t=this.element===this.element.window,i=this.adapter.offset(),s={};this.handleScroll(),e={horizontal:{contextOffset:t?0:i.left,contextScroll:t?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:t?0:i.top,contextScroll:t?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}};for(var n in e){var o=e[n];for(var r in this.waypoints[n]){var a,l,h,c,d,m=this.waypoints[n][r],u=m.options.offset,p=m.triggerPoint,f=0,g=null==p;m.element!==m.element.window&&(f=m.adapter.offset()[o.offsetProp]),"function"==typeof u?u=u.apply(m):"string"==typeof u&&(u=parseFloat(u),m.options.offset.indexOf("%")>-1&&(u=Math.ceil(o.contextDimension*u/100))),a=o.contextScroll-o.contextOffset,m.triggerPoint=f+a-u,l=p<o.oldScroll,h=m.triggerPoint>=o.oldScroll,c=l&&h,d=!l&&!h,!g&&c?(m.queueTrigger(o.backward),s[m.group.id]=m.group):!g&&d?(m.queueTrigger(o.forward),s[m.group.id]=m.group):g&&o.oldScroll>=m.triggerPoint&&(m.queueTrigger(o.forward),s[m.group.id]=m.group)}}for(var v in s)s[v].flushTriggers();return this},i.findOrCreateByElement=function(e){return i.findByElement(e)||new i(e)},i.refreshAll=function(){for(var e in n)n[e].refresh()},i.findByElement=function(e){return n[e.waypointContextKey]},window.onload=function(){l&&l(),i.refreshAll()},r.Context=i}(),function(){"use strict";function e(e,t){return e.triggerPoint-t.triggerPoint}function i(e,t){return t.triggerPoint-e.triggerPoint}function s(e){this.name=e.name,this.axis=e.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),n[this.axis][this.name]=this}var n={vertical:{},horizontal:{}},o=t.Waypoint;s.prototype.add=function(e){this.waypoints.push(e)},s.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},s.prototype.flushTriggers=function(){for(var t in this.triggerQueues){var s=this.triggerQueues[t],n="up"===t||"left"===t;s.sort(n?i:e);for(var o=0,r=s.length;o<r;o+=1){var a=s[o];(a.options.continuous||o===s.length-1)&&a.trigger([t])}}this.clearTriggerQueues()},s.prototype.next=function(t){this.waypoints.sort(e);var i=o.Adapter.inArray(t,this.waypoints),s=i===this.waypoints.length-1;return s?null:this.waypoints[i+1]},s.prototype.previous=function(t){this.waypoints.sort(e);var i=o.Adapter.inArray(t,this.waypoints);return i?this.waypoints[i-1]:null},s.prototype.queueTrigger=function(e,t){this.triggerQueues[t].push(e)},s.prototype.remove=function(e){var t=o.Adapter.inArray(e,this.waypoints);t>-1&&this.waypoints.splice(t,1)},s.prototype.first=function(){return this.waypoints[0]},s.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},s.findOrCreate=function(e){return n[e.axis][e.name]||new s(e)},o.Group=s}(),function(){"use strict";function i(t){this.$element=e(t)}var s=t.Waypoint;e.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(e,t){i.prototype[t]=function(){var e=Array.prototype.slice.call(arguments);return this.$element[t].apply(this.$element,e)}}),e.each(["extend","inArray","isEmptyObject"],function(t,s){i[s]=e[s]}),s.adapters.push({name:"jquery",Adapter:i}),s.Adapter=i}(),function(){"use strict";function e(e){return function(){var t=[],s=arguments[0];return e.isFunction(arguments[0])&&(s=e.extend({},arguments[1]),s.handler=arguments[0]),this.each(function(){var n=e.extend({},s,{element:this});"string"==typeof n.context&&(n.context=e(this).closest(n.context)[0]),t.push(new i(n))}),t}}var i=t.Waypoint;t.$&&(t.$.fn.waypoint=e(t.$))}(),t.Waypoint}.apply(t,s),!(void 0!==n&&(e.exports=n))}).call(t,i(5))},92:function(e,t,i){var s,n;try{s=[i(12),i(9),i(11),i(10),i(63),i(72),i(93),i(107),i(70),i(90),i(35),i(18),i(3),i(50)],n=function(e,t,i,s,n,o,r,a,l,h,c,d,m,u){var p=n.extend({templateName:"comment_thread",mixins:[l,h],events:{"click .vf-replies-button":"loadReplies","click .vf-rt-reply":"loadRealtimeReplies","touchstart .vf-rt-reply":"touchstartReply","touchend .vf-rt-reply":"touchendReply"},initialize:function(e){t.bindAll(this,"afterLoad","rtAfterLoad","realtimeRenderNotification","updateLoadReplies"),this.new_replies=0,this.new_replies_counter_limit=10,this.views=[];var i=[];this.model.has("thread")&&(i=this.model.getThreadsAsc()),this.collection=this.model.replies(),this.collection.add(i),this.collection.before_id=t.result(t.last(i),"id"),this.collection.after_id=t.result(t.first(i),"id"),this.subviews={root_comment:new r({model:this.model,hasRealtime:e.hasRealtime}),replies:new a({collection:this.collection,view:r,canView:e.canView,hasRealtime:e.hasRealtime})},e.hasRealtime&&this.listenTo(u,"content",this.realtimeUpdate)},findComment:function(e){return e(this)?this:this.findReply(e)},findReply:function(e){return t.find(this.subviews.replies.views,e)},render:function(){if(this.templateOnly(this.model.toJSON()),this.subviews.replies.render(),this.$load_replies=this.$(".vf-replies-button"),(!this.model.thread||this.model.thread.after_count<1)&&this.$load_replies.parent().addClass("hidden"),this.$rtReplyNote=this.$el.find(".vf-rt-reply"),this.$rtReplyNoteText=this.$el.find(".vf-rt-label"),this.$rtReplyNoteCount=this.$el.find(".vf-rt-bubble-text"),this.listenTo(s,"comment:created",this.addReplies),d.isMobileOrTablet()){var e=this.$el.find(".vf-rt-reply .vf-rt-hover-state");this.rt_reply={$el:e,heightDefault:e.height()}}return this},addReplies:function(e){return this.model.get("thread_id")===e.get("thread_id")&&this.subviews.replies.collection.add(e,{slide:!0}),this},realtimeUpdate:function(e){if(e&&this.filter_id&&this.filter_id===e.filter_id&&e&&e.thread_uuid&&e.thread_uuid===d.toUuid(this.model.get("thread_id")))switch(e.event_type){case"comment.enable":!this.isSelf(e,m.current.user)&&this.notYetLoaded(d.toVfId(e.comment_uuid))&&this.realtimeIncrement();break;default:return}},notYetLoaded:function(e){return this.model.get("id")!==e&&!this.collection.isLoadedThread(e)},realtimeReset:function(){this.new_replies=0,this.realtimeRenderNotification()},realtimeIncrement:function(){this.$rtReplyNote.removeClass("invisible"),this.new_replies=this.new_replies+1,this.realtimeRenderNotification()},realtimeRenderNotification:function(){this.$rtReplyNote.toggleClass("invisible",0===this.new_replies),this.$rtReplyNote.addClass("vf-rt-sliding").one("transitionend webkitTransitionEnd",function(){this.$rtReplyNote.removeClass("vf-rt-sliding")}.bind(this)),this.$rtReplyNoteText.html(this.i18n("comment_has_realtime_replies",this.new_replies,this.new_replies_counter_limit)),this.$rtReplyNoteCount.toggleClass("vf-rt-over-limit",this.new_replies>this.new_replies_counter_limit).html(this.new_replies<=this.new_replies_counter_limit?this.new_replies:this.new_replies_counter_limit+"+"),this.rt_reply&&(this.rt_reply.heightOnHover=this.$rtReplyNote.height(),this.rt_reply.transition=this.$rtReplyNote.find(".vf-rt-hover-state").css("transition"))},updateLoadReplies:function(){this.collection&&this.collection.after_count&&this.collection.after_count>0?this.$load_replies.html(this.i18n("comment_has_replies",this.collection.after_count)).parent().removeClass("hidden"):this.$load_replies.parent().addClass("hidden")},loadRealtimeReplies:function(e){e.preventDefault();var t=this.collection.length>0?this.rtAfterLoad:this.afterLoad;s.trigger("threads:cleanRealtimeNew",this.model.get("thread_id"));var i=this.collection.settings&&this.collection.settings.limit?this.collection.settings.limit:10;this.collection.settings.limit=50,this.collection.fetchPageBefore({slide:!0,realtimeNewComment:!0,success:function(){s.trigger("/commenting/comment/rt-load-replies",this.model.page,this.model),t()}.bind(this)}),this.collection.settings.limit=i},loadReplies:function(e){e.preventDefault(),this.collection&&(this.collection.settings.limit=this.collection.length<=2?10-this.collection.length:10,this.collection.fetchPageAfter({prepend:!0,slide:!0,success:function(){s.trigger("/commenting/comment/load-replies",this.model.page,this.model),this.updateLoadReplies()}.bind(this)}))},afterLoad:function(){this.updateLoadReplies(),this.rtAfterLoad()},rtAfterLoad:function(){this.new_replies=this.collection.before_count,this.realtimeRenderNotification()},closeReplies:function(){this.subviews.root_comment.closeReplyBox(),this.subviews.replies.each(function(e){e.closeReplyBox()})},remove:function(){this.subviews.root_comment&&(this.subviews.root_comment.remove(),this.subviews.root_comment=null),n.prototype.remove.call(this)},touchstartReply:function(e){h.renderHoverStyles(e,this.rt_reply.$el,this.rt_reply.heightOnHover,this.rt_reply.transition)},touchendReply:function(e){h.removeHoverStyles(e,this.rt_reply.$el,this.rt_reply.heightDefault,this.rt_reply.reply_transition),this.loadRealtimeReplies(e)},updateFilterID:function(e){this.filter_id=e,t.each(this.views,function(t){t.filter_id=e}),this.subviews.root_comment.filter_id=e,this.subviews.replies.updateFilterID(e)}});return p}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},93:function(e,t,i){var s,n;(function(o){try{s=[i(9),i(12),i(7),i(3),i(18),i(23),i(50),i(10),i(64),i(15),i(83),i(94),i(95),i(70),i(63),i(96),i(97),i(76),i(99),i(100),i(77),i(102),i(81),i(103),i(105),i(106)],n=function(e,t,i,s,n,r,a,l,h,c,d,m,u,p,f,g,v,_,w,y,b,$,S,C,k,x){var E={};l.on("/commenting/reply/save",function(e,t){E[t]=e});var T=f.extend({templateName:"comment",mixins:[p,u],likeLocked:!1,wasEdited:!1,events:{"click .vf-username":"openProfile","click .vf-like-btn":"like","click .vf-new-like-btn":"like","click .vf-dislike-btn":"dislike","click .vf-reply-btn":"reply","click .vf-flag":"flag","click .vf-show-more":"showMoreorLess","click .vf-rt-has-edit-link":"reload","click .vf-photo":"showImagePreview","click .vf-inline-video":"playVideo","click .vf-share-btn":"shareClick","mouseover .vf-share-btn":"openShareOptions","mouseover .vf-date":"initDateTooltip"},initialize:function(){e.bindAll(this,"onFlagSuccess","onFlagError","onLikeError","onLikeSuccess","addShareEvents","trackTwitterTweet","trackFacebookLike","trackEmailShare","onCloseShares","onRefreshSuccess","realtimeNewCommentChange"),this.views={avatar:new b({user:this.model.user}),processing_status:new $({comment:this.model})},this.rollCounters={num_likes:{el:".vf-count-likes span",prop:"num_likes"},num_dislikes:{el:".vf-count-dislikes span",prop:"num_dislikes"}},this.closeDelay=500,this.show_more=!0,this.listenTo(this.model,"change:editor_pick",this.render),this.listenTo(this.model,"change:processing_status",this.render),this.listenTo(this.model,"change:content",this.contentChange),this.listenTo(this.model,"change:realtimeNewComment",this.realtimeNewCommentChange),this.listenTo(this.model.user,"change",this.render),this.listenTo(s.current.user,"change:id, change:email_verification_status",this.render),this.options.hasRealtime&&this.listenTo(a,"content",this.realtimeUpdate)},render:function(){var e=this.templateJSON(),t=this.domainSettings.get("show_more_character_limit");this.isProfileView||this.renderUserActions(),this.templateOnly(e);var i=[];if(!this.isProfileView&&this.byCurrentUser()){var s=this.currentUser.hasUnverifiedEmail()&&!this.currentUser.has("email"),n=this.currentUser.hasUnapprovedUsername();this.views.verification_status=new S({model:this.model.user,warning:!1,data:{email_pending:s,username_pending:n}});var o;s&&(o="comment_limit_email"),n&&!this.currentUser.get("name")&&(o=o?"comment_limit_email_and_name":"comment_limit_name"),o||i.push("verification_status"),this.views.verification_status.message=o}this.insertSubViews(this.views,{disabledViews:i,isComment:!0}),this.model.user.isGuest()&&(this.$el.addClass("vf-is-anonymous"),this.$el.undelegate(".vf-username","click"));var r=E[this.model.id];if(void 0!==r&&this.renderReplyBox(r),"administrator"===e.user_privilege&&(e.user_privilege="moderator"),this.model.isRemoved()&&(this.renderRemoved(),!this.currentUser.isModOrAdmin()))return this;this.renderTime(this.liveRenderTime()),this.model.isVideoComplete()?e.video_placeholder=e.video.thumbs.medium:this.model.isVideoProcessing()&&this.videoPoll();var a=e.content.replace(/&#?[a-zA-Z0-9]+;/g,"#");a.length>t&&this.subStringLastWord(a,t).length!=a.length&&this.showMoreorLess(),this.can("moderate",this.model)&&this.showModeration();var h=this.$(".vf-ajax-loader-wrap");return h[0]&&h.loader("show",{inside:!0,gifType:"bluegray"}),this.initTipsy(),this.initDateTooltip(),this.initializeAnimation(),l.trigger("/commenting/comment/render",this.model,this.$el[0]),l.trigger("/commenting/resize"),this},userHasCommentLimit:function(){return this.byCurrentUser()&&this.currentUser.hasCommentLimit()},byCurrentUser:function(){return this.currentUser.isLoggedIn()&&this.model.user.get("id")===this.currentUser.get("id")},initTipsy:function(){var e=1===this.model.get("liked")?"unlike_tip":"like_tip",t=1===this.model.get("disliked")?"undislike_tip":"dislike_tip";n.isMobileOrTablet()||(this.$el.find(".vf-new-like-btn").tipsy({title:e,delayIn:1e3}),this.$el.find(".vf-dislike-btn").tipsy({title:t,delayIn:1e3}))},updateTipsyTitles:function(){var e=1===this.model.get("liked")?"unlike_tip":"like_tip",t=1===this.model.get("disliked")?"undislike_tip":"dislike_tip";this.$el.find(".vf-new-like-btn").tipsy("hide").tipsy("setTitle",e),this.$el.find(".vf-dislike-btn").tipsy("hide").tipsy("setTitle",t)},renderRemoved:function(){this.currentUser.isModOrAdmin()?this.$(".vf-comment-actions, .vf-flag").remove():(this.$(".vf-comment-html").empty(),this.$(".vf-user-meta, .vf-comment-meta, .vf-comment-actions, .vf-flag, .vf-ajax-loader, .vf-media-container").remove(),this.$(".vf-avatar").attr("src",this.currentUser.defaults.pic_small)),this.views.user_actions&&this.removeUserActions()},renderUserActions:function(){this.can("update",this.model)||this.can("remove",this.model)?void 0===this.views.user_actions&&(this.views.user_actions=new k({comment:this.model,parent:this}),this.listenTo(this.views.user_actions,"edit",this.startEdit),this.listenTo(this.views.user_actions,"lock",this.removeUserActions),this.listenTo(this.views.user_actions,"remove",this.onRemoved)):this.views.user_actions&&this.removeUserActions()},templateJSON:function(){var e=this.model.toJSON();e.isProfileView=this.isProfileView;var t=this.model.get("page");return e.isProfileView&&(t?e.page_title=t.title:e.page_title=""),e.hideReply=!1,t&&("closed"===t.status||t.statusDisplayOnly)&&(e.hideReply=!0),this.domainSettings.get("disableReply")&&(e.hideReply=!0),e.showFlag=!(s.current.user.isBanned()||this.model.user.isModOrAdmin()||s.current.user.hasUnverifiedEmail()||s.current.user.hasUnapprovedUsername()),e.showTrusted=this.domainSettings.get("badging_trusted_display"),e.showMod=this.domainSettings.get("badging_moderator_display"),
e.enableDislikes=1===this.domainSettings.get("enable_dislikes"),e.likeClass=1===this.model.get("liked")?"active":"",e.dislikeClass=1===this.model.get("disliked")?"active":"",e.userPendingNew="pending_new"===s.current.user.get("username_verification_status"),e.wasEdited=this.wasEdited,e.current_page_id=s.current.page.id,e.email_unverified="pending_new"===s.current.user.get("email_verification_status")?1:0,1===this.domainSettings.get("enable_username_premoderation")&&s.current.user.hasUnapprovedUsername()&&this.byCurrentUser()&&(e.user.name=e.user.username_pending),e},renderTime:function(){var e=this.getRelativeTime(this.model.get("date_created"),this.domainSettings.currentTime());this.model.get("date_edited")&&(e+=this.domainSettings.currentTime()-1e3*this.model.get("date_edited")<=36e5?" "+this.i18n("post_edited_recently"):" "+this.i18n("post_edited")),this.$(".vf-date").text(e)},liveRenderTime:function(){var e=this,t=3e4;setInterval(function(){return e.renderTime()},t)},initDateTooltip:function(){var e=1e3;this.$(".vf-date").css({cursor:"pointer"}).tipsy({template:"datetooltip",gravity:"nw",interactive:!0,delayIn:e,delayOut:100,offset:0});var i=new Date(1e3*this.model.get("date_created")),s=i.toLocaleDateString(r.language,{month:"long",day:"numeric"}),n=i.toLocaleTimeString(r.language,{hour:"numeric",minute:"numeric",timeZoneName:"short"});window.setTimeout(function(){t(".vf-date-posted").text(s),t(".vf-time-posted").text(n)},e)},like:function(e){e.preventDefault(),this.likeAction(this.model.toggleLike.bind(this.model))},dislike:function(e){e.preventDefault(),this.likeAction(this.model.toggleDislike.bind(this.model))},likeAction:function(e){!this.likeLocked&&this.authorize("like",this.model)&&(this.likeLocked=!0,t.fn.loader.hideErrors(),this.$(".vf-like-btn,.vf-new-like-btn").loader("show"),e({success:this.onLikeSuccess,error:this.onLikeError}))},onLikeSuccess:function(){this.likeLocked=!1,this.$(".vf-like-btn,.vf-new-like-btn").loader("hide"),this.updateTipsyTitles(),this.likesChanged()},onLikeError:function(e){this.likeLocked=!1,this.$(".vf-like-btn,.vf-new-like-btn").loader("error").tipsy({title:d.codeToI18n(e.api_code)[0],interactive:!0,delayOut:300}),this.likesChanged()},likesChanged:function(){var e=this.$el.find(".vf-like-btn:first"),t=this.model.get("liked");this.model.get("num_likes");if(e.text(0===t?this.i18n("like_lnk"):this.i18n("unlike_lnk")),this.domainSettings.get("enable_dislikes")){var i=this.model.get("disliked"),s=this.$el.find(".vf-dislike-text:first");s.text(0===i?this.i18n("dislike_lnk"):this.i18n("undislike_lnk")),this.$el.find(".vf-new-like-btn").toggleClass("active",1===t),this.$el.find(".vf-dislike-btn").toggleClass("active",1===i)}},reply:function(e){e.preventDefault(),this.renderReplyBox()},renderReplyBox:function(e){if(!this.isProfileView)if(!this.replybox||e){this.$(".vf-reply-btn").addClass("vf-cancel-reply").text(this.i18n("cancel_btn_lnk"));var t={comment:this.model,user:s.current.user,prefix:"@"+this.model.user.get("name")+" ",text:e,settings:this.domainSettings};this.replybox=new _(t),this.listenTo(this.replybox,"comment:submitted",this.closeReplyBox),this.$(this.$(".vf-rt-new-circle")?".vf-rt-new-circle":".vf-comment-meta").before(this.replybox.render().el);var i=this.$(".vf-content")[0];i.selectionStart=i.selectionEnd=i.value.length,i.focus(),l.trigger("/commenting/comment/reply",this.model),l.trigger("/commenting/resize")}else this.closeReplyBox()},closeReplyBox:function(){this.replybox&&(this.$(".vf-reply-btn").removeClass("vf-cancel-reply").text(this.i18n("reply_lnk")),delete E[this.model.id],this.replybox.remove(),delete this.replybox)},flag:function(e){e.preventDefault(),!this.flagged&&this.authorize("flag",this.model)&&(this.flagged=!0,this.restAPI.request("put","flags/"+this.model.id,{},{success:this.onFlagSuccess,error:this.onFlagError}),t.fn.loader.hideErrors(),this.$(".vf-flag").loader("show"))},onFlagSuccess:function(){this.$(".vf-flag").addClass("vf-flagged").text(this.i18n("flagged_lnk")),this.$(".vf-flag").loader("hide")},onFlagError:function(e){this.flagged=!1,this.$(".vf-flag").loader("error").tipsy({title:d.codeToI18n(e.api_code)[0],interactive:!0,delayOut:300})},showModeration:function(){this.moderation=new y({model:this.model}),this.$el.append(this.moderation.render().el),this.listenTo(this.moderation,"change:user",this.render),this.listenTo(this.moderation,"error",this.onModError),this.listenTo(this.moderation,"click",this.hideError)},startEdit:function(){void 0===this.commentEditForm&&(this.closeReplyBox(),this.commentEditForm=new C({holder:this.$(".vf-comment-html"),model:this.model}),this.commentEditForm.replaceHolder(),this.listenTo(this.commentEditForm,"finish",this.onEditFinish),this.$(".vf-comment-meta, .vf-comment-actions, .vf-comment-edit-links, .vf-comment-user-actions, .vf-was-edited").hide(),this.commentEditForm.render())},removeUserActions:function(){this.stopListening(this.views.user_actions),this.views.user_actions.remove(),delete this.views.user_actions},onRemoved:function(){this.renderRemoved()},onEditFinish:function(){this.commentEditForm.revertHolder(),this.commentEditForm.remove(),this.$(".vf-comment-meta, .vf-comment-actions, .vf-comment-edit-links, .vf-comment-user-actions, .vf-was-edited").show();var e=h.formatLinks(this.model.get("content"));this.$(".vf-comment-html").html(e),this.renderTime(),this.stopListening(this.commentEditForm),delete this.commentEditForm},showMoreorLess:function(e){var i,s,n=this.model.toJSON();if(this.isProfileView?(s="format",i=this.$el.find(".vf-comment-html a")):(s="formatLinks",i=this.$el.find(".vf-comment-html")),e&&e.preventDefault){e.preventDefault();var o=t(e.target),r=o.data().action;"more"===r?this.show_more=!1:this.show_more=!0,i=o.parent()}var a,c=this.domainSettings.get("show_more_character_limit");a=this.show_more?this.subStringLastWord(n.content,c):n.content,a=h[s](a),i.html(a),this.$show_more=this.template({isShowMore:this.show_more},"show_more"),i.append(this.$show_more),l.trigger("/commenting/resize")},contentChange:function(e,t){this.$(".vf-comment-html").text(t)},playVideo:function(e){e.preventDefault();var t=this.model.toJSON();t.video&&(this.video=new m(t.video),this.player=new v({model:this.video}),this.$el.find(".vf-inline-video:first").replaceWith(this.player.$el),this.player.render())},videoPoll:function(){if(this.model.isVideoProcessing()&&!this.stopPolling&&i.video_poll){var e=this;this.model.fetch({success:function(){e.model.isVideoComplete()?e.displayVideo():o(e.videoPoll.bind(e),5e3)},error:function(){o(e.videoPoll.bind(e),1e4)}})}},displayVideo:function(){this.render()},openProfile:function(e){e.preventDefault(),e.stopPropagation(),this.model.user.get("id")&&l.trigger("/user/account/click",this.model.user)},showImagePreview:function(e){e.preventDefault(),l.trigger("/modal/generic",new x({model:this.model}))},trackEmailShare:function(e){e.preventDefault();var t="mailto:?subject=Check%20out%20this%20comment&body=Check%20out%20this%20comment:%20"+this.model.shareLink(),i=function(){window.location.href=t};this.restAPI.request("post","analytics/shares",{provider:"email",id:this.model.id},{success:i,error:i}),this.$(".vf-share-options").tipsy("hide")},trackFacebookLike:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.shareLink();this.openShareLink("http://www.facebook.com/sharer/sharer.php?u="+t,"Facebook"),this.restAPI.request("post","analytics/shares",{provider:"facebook",id:this.model.id}),this.$(".vf-share-options").tipsy("hide")},shareClick:function(e){e.preventDefault()},trackTwitterTweet:function(e){e.stopPropagation(),e.preventDefault();var t=this.model.shareLink(),i=encodeURIComponent(this.i18n("twitter_share_comment"));this.openShareLink("https://twitter.com/intent/tweet?text="+i+":%20"+t,"Twitter"),this.restAPI.request("post","analytics/shares",{provider:"twitter",id:this.model.id}),this.$(".vf-share-options").tipsy("hide")},openShareLink:function(e,t){window.open(e,t,"status = 1, height = 350, width = 550, resizable = 0")},onCloseShares:function(){this.closeTimer=0,this.$(".vf-share-btn").show(),this.$(".vf-social-icon").hide()},openShareOptions:function(){this.$(".vf-share-options").show().tipsy({title:"share-menu",template:"sharemenu",gravity:"ne",interactive:!0,delayOut:300,offset:0,onOpen:this.addShareEvents}).tipsy("show")},addShareEvents:function(e){e.$tip.on("click",function(e){e.stopPropagation()}),e.$tip.find(".vf-facebook-like").on("click",this.trackFacebookLike),e.$tip.find(".vf-twitter-tweet").on("click",this.trackTwitterTweet),e.$tip.find(".vf-email-icon").on("click",this.trackEmailShare)},remove:function(){this.stopPolling=!0,f.prototype.remove.call(this)},showError:function(e){this.hideError(),this.$el.addClass("has-top-banner").prepend("<div class='vf-mod-error'>"+e+"</div>")},hideError:function(){this.$el.removeClass("has-top-banner"),this.$(".vf-mod-error").remove()},onModError:function(e){var t;65554==e.api_code?(t=this.i18n("outdated_content"),this.model.fetch({success:this.onRefreshSuccess})):t=e.error||this.i18n("something_went_wrong"),this.showError(t)},onRefreshSuccess:function(){this.showError(this.i18n("outdated_content_updated"))},realtimeUpdate:function(e){if(e&&this.filter_id&&this.filter_id===e.filter_id&&e.comment_uuid&&e.comment_uuid===n.toUuid(this.model.id))if("comment.enable"===e.event_type)this.model.set("processing_status","completed"),this.render();else if(!this.isSelf(e,s.current.user))switch(e.event_type){case"comment.liked":this.model.set("num_likes",this.model.get("num_likes")+1);break;case"comment.disliked":this.model.set("num_dislikes",this.model.get("num_dislikes")+1);break;case"comment.unliked":this.model.set("num_likes",this.model.get("num_likes")-1);break;case"comment.undisliked":this.model.set("num_dislikes",this.model.get("num_dislikes")-1);break;case"comment.edit":this.wasEdited=!0,this.render();break;default:return}},realtimeNewCommentChange:function(e){this.$el.toggleClass("vf-rt-new",e.get("realtimeNewComment"))},reload:function(e){e.preventDefault(),this.listenToOnce(this.model,"sync",function(){this.wasEdited=!1,this.render()}.bind(this)),this.model.fetch()}});return T}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},94:function(e,t,i){var s,n;try{s=[i(27)],n=function(e){var t=e.extend({url:"/media"});return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},95:function(e,t,i){var s,n;try{s=[i(12),i(18)],n=function(e,t){function i(e,t,i){e.find(".raw-number, .roller-number").prepend("<span>"+i+"</span>"),e.find(".roller-current:first").addClass("transitionable invisible").css({transform:"translateY(0)"}),e.find(t).find("span:first").addClass("transitionable").css({transform:"translateY(0)",opacity:.25}).css("opacity")}function s(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return i}function n(e){return e.toString(10)}var o='<div class="vf-rolling-child"><div class="raw-number"></div><div class="roller-number roller-prev"></div><div class="roller-number roller-current"></div><div class="roller-number roller-next"></div>',r={initializeAnimation:function(){this.rollerFormatter||(this.rollerFormatter=n),e.each(this.rollCounters,function(e,t){t.$elCounter=this.$el.find(t.el),this.counterResetDOM(t.prop),t.animation_complete=!0,this.stopListening(this.model,"change:"+t.prop),this.listenTo(this.model,"change:"+t.prop,this.counterUpdate.bind(this,t.prop))}.bind(this))},counterUpdate:function(n){if(t.getIEVersion()>0&&t.getIEVersion()<10)return void this.rollCounters[n].$elCounter.html(this.model.get(n));if(this.rollCounters[n].animation_complete===!0){var o=this.model.previous(n),r=this.model.get(n),a=this.rollCounters[n].$elCounter;r<0&&(r=0);var l=this.rollerFormatter(o,this.rollCounters[n]),h=this.rollerFormatter(r,this.rollCounters[n]),c=r>o?".roller-next":".roller-prev";if(l!=h){for(this.rollCounters[n].animation_complete=!1;l.length<h.length;){var d=h[h.length-l.length-1];i(a,c,d),l="0"+l}for(;l.length>h.length;)h=" "+h;for(var m=s(l,h),u=a.find(c+" span"),p=u.length-1;p>=0;p--)u[p].innerHTML=h[p];if(null!==m){var f=this;a.find(".roller-number span").css({transform:r>o?"translateY(-100%)":"translateY(100%)",opacity:e(this).hasClass("roller-current")?.25:1}).on("transitionend webkitTransitionEnd",function(){e(this).off("transitionend webkitTransitionEnd"),f.counterResetDOM(n,a,r)})}else this.counterResetDOM(n,a,r)}}},counterResetDOM:function(i,s,n){if(!(t.getIEVersion()>0&&t.getIEVersion()<10)){this.rollCounters[i].animation_complete=!0;var r=this.model.get(i),s=this.rollCounters[i].$elCounter;if(void 0!==r&&void 0!==s){for(var a=this.rollerFormatter(r),l=e("<div>").addClass("vf-rolling-child"),h=0;h<a.length;h++)l.append('<span class="transitionable">'+a[h]+"</span>");s.empty().addClass("vf-rolling").append(o),s.find(".roller-number").empty().append(l.html()),s.find(".roller-prev span, .roller-next span").css({transform:"translateY(0)",opacity:.25});var c=this.rollerFormatter(void 0!==n?n:r);s.find(".raw-number").empty().html(c),void 0!==n&&n!==r&&s.find(".roller-prev").on("transitionend webkitTransitionEnd",function(){this.counterUpdate(i)}.bind(this))}}}};return r}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},97:function(e,t,i){var s,n;try{s=[i(63),i(98),i(7)],n=function(e,t,i){var s=e.extend({attributes:{class:"vf-player"},initialize:function(e){this.startPaused=e.startPaused||!1},templateName:"player",render:function(){var e=this.model,s=e.attributes.mp4,n=e.attributes.webm,o=e.id;this.id=o||1;var r=this.$el.parent().width()||400,a=r/16*9|0;r*=.75,a*=.75,s&&n&&(s=s.replace("https:",location.protocol),n=n.replace("https:",location.protocol)),this.$el.append(this.template({mp4:s,webm:n,id:o,height:a,width:r}));var l="http://get.adobe.com/flashplayer";return this.mejs=new t(this.$("video")[0],{features:["playpause","progress","current","duration","volume"],startVolume:.5,plugins:["flash"],errorHtml:this.i18n("download_flash",l),pluginPath:i.asset_url+"swf/",success:function(e){this.startPaused||e.play()}.bind(this)}),this},videoRendered:function(){return!!this.mejs},play:function(){return this.videoRendered()&&this.mejs.play&&this.mejs.play(),this},pause:function(){return this.videoRendered()&&this.mejs.pause&&this.mejs.pause(),this}});return s}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},98:function(e,t,s){var n;(function(o){n=function(){return window.mejs=window.mejs||{},mejs.version="2.11.0",mejs.meIndex=0,mejs.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mpeg","video/youtube","video/x-youtube"]}],youtube:[{version:null,types:["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],vimeo:[{version:null,types:["video/vimeo","video/x-vimeo"]}]},mejs.Utility={encodeUrl:function(e){return encodeURIComponent(e)},escapeHTML:function(e){return e.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this.escapeHTML(e)+'">x</a>',t.firstChild.href},getScriptPath:function(e){for(var t,i,s=0,n="",o="",r=document.getElementsByTagName("script"),a=r.length,l=e.length;s<a;s++){for(i=r[s].src,t=0;t<l;t++)if(o=e[t],i.indexOf(o)>-1){n=i.substring(0,i.indexOf(o));break}if(""!==n)break}return n},secondsToTimeCode:function(e,t,i,s){"undefined"==typeof i?i=!1:"undefined"==typeof s&&(s=25);var n=Math.floor(e/3600)%24,o=Math.floor(e/60)%60,r=Math.floor(e%60),a=Math.floor((e%1*s).toFixed(3)),l=(t||n>0?(n<10?"0"+n:n)+":":"")+(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)+(i?":"+(a<10?"0"+a:a):"");return l},timeCodeToSeconds:function(e,t,i,s){"undefined"==typeof i?i=!1:"undefined"==typeof s&&(s=25);var n=e.split(":"),o=parseInt(n[0],10),r=parseInt(n[1],10),a=parseInt(n[2],10),l=0,h=0;return i&&(l=parseInt(n[3])/s),h=3600*o+60*r+a+l},convertSMPTEtoSeconds:function(e){if("string"!=typeof e)return!1;e=e.replace(",",".");var t=0,i=e.indexOf(".")!=-1?e.split(".")[1].length:0,s=1;e=e.split(":").reverse();for(var n=0;n<e.length;n++)s=1,n>0&&(s=Math.pow(60,n)),t+=Number(e[n])*s;return Number(t.toFixed(i))},removeSwf:function(e){var t=document.getElementById(e);t&&/object|embed/i.test(t.nodeName)&&(mejs.MediaFeatures.isIE?(t.style.display="none",function(){4==t.readyState?mejs.Utility.removeObjectInIE(e):o(arguments.callee,10)}()):t.parentNode.removeChild(t))},removeObjectInIE:function(e){var t=document.getElementById(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}},mejs.PluginDetector={hasPluginVersion:function(e,t){var i=this.plugins[e];return t[1]=t[1]||0,t[2]=t[2]||0,i[0]>t[0]||i[0]==t[0]&&i[1]>t[1]||i[0]==t[0]&&i[1]==t[1]&&i[2]>=t[2]},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(e,t,i,s,n){this.plugins[e]=this.detectPlugin(t,i,s,n)},detectPlugin:function(e,t,i,s){var n,o,r,a=[0,0,0];if("undefined"!=typeof this.nav.plugins&&"object"==typeof this.nav.plugins[e]){if(n=this.nav.plugins[e].description,n&&("undefined"==typeof this.nav.mimeTypes||!this.nav.mimeTypes[t]||this.nav.mimeTypes[t].enabledPlugin))for(a=n.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split("."),o=0;o<a.length;o++)a[o]=parseInt(a[o].match(/\d+/),10)}else if("undefined"!=typeof window.ActiveXObject)try{r=new ActiveXObject(i),r&&(a=s(r))}catch(e){}return a}},mejs.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(e){var t=[],i=e.GetVariable("$version");return i&&(i=i.split(" ")[1].split(","),t=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]),t}),mejs.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(e){var t=[0,0,0,0],i=function(e,t,i,s){for(;e.isVersionSupported(t[0]+"."+t[1]+"."+t[2]+"."+t[3]);)t[i]+=s;t[i]-=s};return i(e,t,0,1),i(e,t,1,1),i(e,t,2,1e4),i(e,t,2,1e3),i(e,t,2,100),i(e,t,2,10),i(e,t,2,1),i(e,t,3,1),t}),mejs.MediaFeatures={init:function(){var e,t,i=this,s=document,n=mejs.PluginDetector.nav,o=mejs.PluginDetector.ua.toLowerCase(),r=["source","track","audio","video"];i.isiPad=null!==o.match(/ipad/i),i.isiPhone=null!==o.match(/iphone/i),i.isiOS=i.isiPhone||i.isiPad,i.isAndroid=null!==o.match(/android/i),i.isBustedAndroid=null!==o.match(/android 2\.[12]/),i.isIE=n.appName.toLowerCase().indexOf("microsoft")!=-1,i.isChrome=null!==o.match(/chrome/gi),i.isFirefox=null!==o.match(/firefox/gi),i.isWebkit=null!==o.match(/webkit/gi),i.isGecko=null!==o.match(/gecko/gi)&&!i.isWebkit,i.isOpera=null!==o.match(/opera/gi),i.hasTouch="ontouchstart"in window,i.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect;for(e=0;e<r.length;e++)t=document.createElement(r[e]);i.supportsMediaTag="undefined"!=typeof t.canPlayType||i.isBustedAndroid,i.hasSemiNativeFullScreen="undefined"!=typeof t.webkitEnterFullscreen,i.hasWebkitNativeFullScreen="undefined"!=typeof t.webkitRequestFullScreen,i.hasMozNativeFullScreen="undefined"!=typeof t.mozRequestFullScreen,i.hasTrueNativeFullScreen=i.hasWebkitNativeFullScreen||i.hasMozNativeFullScreen,i.nativeFullScreenEnabled=i.hasTrueNativeFullScreen,i.hasMozNativeFullScreen&&(i.nativeFullScreenEnabled=t.mozFullScreenEnabled),this.isChrome&&(i.hasSemiNativeFullScreen=!1),i.hasTrueNativeFullScreen&&(i.fullScreenEventName=i.hasWebkitNativeFullScreen?"webkitfullscreenchange":"mozfullscreenchange",i.isFullScreen=function(){return t.mozRequestFullScreen?s.mozFullScreen:t.webkitRequestFullScreen?s.webkitIsFullScreen:void 0},i.requestFullScreen=function(e){i.hasWebkitNativeFullScreen?e.webkitRequestFullScreen():i.hasMozNativeFullScreen&&e.mozRequestFullScreen()},i.cancelFullScreen=function(){i.hasWebkitNativeFullScreen?document.webkitCancelFullScreen():i.hasMozNativeFullScreen&&document.mozCancelFullScreen()}),i.hasSemiNativeFullScreen&&o.match(/mac os x 10_5/i)&&(i.hasNativeFullScreen=!1,i.hasSemiNativeFullScreen=!1)}},mejs.MediaFeatures.init(),mejs.HtmlMediaElement={pluginType:"native",isFullScreen:!1,setCurrentTime:function(e){this.currentTime=e},setMuted:function(e){this.muted=e},setVolume:function(e){this.volume=e},stop:function(){this.pause()},setSrc:function(e){for(var t=this.getElementsByTagName("source");t.length>0;)this.removeChild(t[0]);if("string"==typeof e)this.src=e;else{var i,s;for(i=0;i<e.length;i++)if(s=e[i],this.canPlayType(s.type)){this.src=s.src;break}}},setVideoSize:function(e,t){this.width=e,this.height=t}},mejs.PluginMediaElement=function(e,t,i){this.id=e,this.pluginType=t,this.src=i,this.events={},this.attributes={}},mejs.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:!1,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:!0,ended:!1,seeking:!1,duration:0,error:null,tagName:"",muted:!1,volume:1,currentTime:0,play:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.playVideo():this.pluginApi.playMedia(),this.paused=!1)},load:function(){null!=this.pluginApi&&("youtube"==this.pluginType||this.pluginApi.loadMedia(),this.paused=!1)},pause:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.pauseVideo():this.pluginApi.pauseMedia(),this.paused=!0)},stop:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.stopVideo():this.pluginApi.stopMedia(),this.paused=!0)},canPlayType:function(e){var t,i,s,n=mejs.plugins[this.pluginType];for(t=0;t<n.length;t++)if(s=n[t],mejs.PluginDetector.hasPluginVersion(this.pluginType,s.version))for(i=0;i<s.types.length;i++)if(e==s.types[i])return"probably";return""},positionFullscreenButton:function(e,t,i){null!=this.pluginApi&&this.pluginApi.positionFullscreenButton&&this.pluginApi.positionFullscreenButton(e,t,i)},hideFullscreenButton:function(){null!=this.pluginApi&&this.pluginApi.hideFullscreenButton&&this.pluginApi.hideFullscreenButton()},setSrc:function(e){if("string"==typeof e)this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(e)),this.src=mejs.Utility.absolutizeUrl(e);else{var t,i;for(t=0;t<e.length;t++)if(i=e[t],this.canPlayType(i.type)){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(i.src)),this.src=mejs.Utility.absolutizeUrl(e);break}}},setCurrentTime:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.seekTo(e):this.pluginApi.setCurrentTime(e),this.currentTime=e)},setVolume:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.setVolume(100*e):this.pluginApi.setVolume(e),this.volume=e)},setMuted:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?(e?this.pluginApi.mute():this.pluginApi.unMute(),this.muted=e,this.dispatchEvent("volumechange")):this.pluginApi.setMuted(e),this.muted=e)},setVideoSize:function(e,t){this.pluginElement.style&&(this.pluginElement.style.width=e+"px",this.pluginElement.style.height=t+"px"),null!=this.pluginApi&&this.pluginApi.setVideoSize&&this.pluginApi.setVideoSize(e,t)},setFullscreen:function(e){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.pluginApi.setFullscreen(e)},enterFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!0)},exitFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!1)},addEventListener:function(e,t,i){this.events[e]=this.events[e]||[],this.events[e].push(t)},removeEventListener:function(e,t){if(!e)return this.events={},!0;var s=this.events[e];if(!s)return!0;if(!t)return this.events[e]=[],!0;for(i=0;i<s.length;i++)if(s[i]===t)return this.events[e].splice(i,1),!0;return!1},dispatchEvent:function(e){var t,i,s=this.events[e];if(s)for(i=Array.prototype.slice.call(arguments,1),t=0;t<s.length;t++)s[t].apply(null,i)},hasAttribute:function(e){return e in this.attributes},removeAttribute:function(e){delete this.attributes[e]},getAttribute:function(e){return this.hasAttribute(e)?this.attributes[e]:""},setAttribute:function(e,t){this.attributes[e]=t},remove:function(){mejs.Utility.removeSwf(this.pluginElement.id),mejs.MediaPluginBridge.unregisterPluginElement(this.pluginElement.id)}},mejs.MediaPluginBridge={pluginMediaElements:{},htmlMediaElements:{},registerPluginElement:function(e,t,i){this.pluginMediaElements[e]=t,this.htmlMediaElements[e]=i},unregisterPluginElement:function(e){delete this.pluginMediaElements[e],delete this.htmlMediaElements[e]},initPlugin:function(e){var t=this.pluginMediaElements[e],i=this.htmlMediaElements[e];if(t){switch(t.pluginType){case"flash":t.pluginElement=t.pluginApi=document.getElementById(e);break;case"silverlight":t.pluginElement=document.getElementById(t.id),t.pluginApi=t.pluginElement.Content.MediaElementJS}null!=t.pluginApi&&t.success&&t.success(t,i)}},fireEvent:function(e,t,i){var s,n,o,r=this.pluginMediaElements[e];s={type:t,target:r};for(n in i)r[n]=i[n],s[n]=i[n];o=i.bufferedTime||0,s.target.buffered=s.buffered={start:function(e){return 0},end:function(e){return o},length:1},r.dispatchEvent(s.type,s)}},mejs.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight","youtube","vimeo"],enablePluginDebug:!1,type:"",pluginPath:mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",flashStreamer:"",enablePluginSmoothing:!1,silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,pluginVars:[],timerRate:250,startVolume:.8,success:function(){},error:function(){}},mejs.MediaElement=function(e,t){return mejs.HtmlMediaElementShim.create(e,t)},mejs.HtmlMediaElementShim={create:function(e,t){var i,s,n=mejs.MediaElementDefaults,o="string"==typeof e?document.getElementById(e):e,r=o.tagName.toLowerCase(),a="audio"===r||"video"===r,l=a?o.getAttribute("src"):o.getAttribute("href"),h=o.getAttribute("poster"),c=o.getAttribute("autoplay"),d=o.getAttribute("preload"),m=o.getAttribute("controls");for(s in t)n[s]=t[s];return l="undefined"==typeof l||null===l||""==l?null:l,h="undefined"==typeof h||null===h?"":h,d="undefined"==typeof d||null===d||"false"===d?"none":d,c=!("undefined"==typeof c||null===c||"false"===c),m=!("undefined"==typeof m||null===m||"false"===m),i=this.determinePlayback(o,n,mejs.MediaFeatures.supportsMediaTag,a,l),i.url=null!==i.url?mejs.Utility.absolutizeUrl(i.url):"","native"==i.method?(mejs.MediaFeatures.isBustedAndroid&&(o.src=i.url,o.addEventListener("click",function(){o.play()},!1)),this.updateNative(i,n,c,d)):""!==i.method?this.createPlugin(i,n,h,c,d,m):(this.createErrorMessage(i,n,h),this)},determinePlayback:function(e,t,i,s,n){var o,r,a,l,h,c,d,m,u,p,f,g=[],v={method:"",url:"",htmlMediaElement:e,isVideo:"audio"!=e.tagName.toLowerCase()};if("undefined"!=typeof t.type&&""!==t.type)if("string"==typeof t.type)g.push({type:t.type,url:n});else for(o=0;o<t.type.length;o++)g.push({type:t.type[o],url:n});else if(null!==n)c=this.formatType(n,e.getAttribute("type")),g.push({type:c,url:n});else for(o=0;o<e.childNodes.length;o++)h=e.childNodes[o],1==h.nodeType&&"source"==h.tagName.toLowerCase()&&(n=h.getAttribute("src"),c=this.formatType(n,h.getAttribute("type")),f=h.getAttribute("media"),(!f||!window.matchMedia||window.matchMedia&&window.matchMedia(f).matches)&&g.push({type:c,url:n}));if(!s&&g.length>0&&null!==g[0].url&&this.getTypeFromFile(g[0].url).indexOf("audio")>-1&&(v.isVideo=!1),mejs.MediaFeatures.isBustedAndroid&&(e.canPlayType=function(e){return null!==e.match(/video\/(mp4|m4v)/gi)?"maybe":""}),i&&("auto"===t.mode||"auto_plugin"===t.mode||"native"===t.mode)){for(s||(p=document.createElement(v.isVideo?"video":"audio"),e.parentNode.insertBefore(p,e),e.style.display="none",v.htmlMediaElement=e=p),o=0;o<g.length;o++)if(""!==e.canPlayType(g[o].type).replace(/no/,"")||""!==e.canPlayType(g[o].type.replace(/mp3/,"mpeg")).replace(/no/,"")){v.method="native",v.url=g[o].url;break}if("native"===v.method&&(null!==v.url&&(e.src=v.url),"auto_plugin"!==t.mode))return v}if("auto"===t.mode||"auto_plugin"===t.mode||"shim"===t.mode)for(o=0;o<g.length;o++)for(c=g[o].type,r=0;r<t.plugins.length;r++)for(d=t.plugins[r],m=mejs.plugins[d],a=0;a<m.length;a++)if(u=m[a],null==u.version||mejs.PluginDetector.hasPluginVersion(d,u.version))for(l=0;l<u.types.length;l++)if(c==u.types[l])return v.method=d,v.url=g[o].url,v;return"auto_plugin"===t.mode&&"native"===v.method?v:(""===v.method&&g.length>0&&(v.url=g[0].url),v)},formatType:function(e,t){return e&&!t?this.getTypeFromFile(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t},getTypeFromFile:function(e){e=e.split("?")[0];var t=e.substring(e.lastIndexOf(".")+1);return(/(mp4|m4v|ogg|ogv|webm|webmv|flv|wmv|mpeg|mov)/gi.test(t)?"video":"audio")+"/"+this.getTypeFromExtension(t)},getTypeFromExtension:function(e){switch(e){case"mp4":case"m4v":return"mp4";case"webm":case"webma":case"webmv":return"webm";case"ogg":case"oga":case"ogv":return"ogg";default:return e}},createErrorMessage:function(e,t,i){var s=e.htmlMediaElement,n=document.createElement("div");n.className="me-cannotplay";try{n.style.width=s.width+"px",n.style.height=s.height+"px"}catch(e){}t.errorHtml?n.innerHTML=t.errorHtml:n.innerHTML=""!==i?'<a href="'+e.url+'"><img src="'+i+'" width="100%" height="100%" /></a>':'<a href="'+e.url+'"><span>Download File</span></a>',s.parentNode.insertBefore(n,s),s.style.display="none",t.error(s)},createPlugin:function(e,t,i,s,n,o){var r,a,l,h=e.htmlMediaElement,c=1,d=1,m="me_"+e.method+"_"+mejs.meIndex++,u=new mejs.PluginMediaElement(m,e.method,e.url),p=document.createElement("div");u.tagName=h.tagName;for(var f=0;f<h.attributes.length;f++){var g=h.attributes[f];1==g.specified&&u.setAttribute(g.name,g.value)}for(a=h.parentNode;null!==a&&"body"!=a.tagName.toLowerCase();){if("p"==a.parentNode.tagName.toLowerCase()){a.parentNode.parentNode.insertBefore(a,a.parentNode);break}a=a.parentNode}switch(e.isVideo?(c=t.videoWidth>0?t.videoWidth:null!==h.getAttribute("width")?h.getAttribute("width"):t.defaultVideoWidth,d=t.videoHeight>0?t.videoHeight:null!==h.getAttribute("height")?h.getAttribute("height"):t.defaultVideoHeight,c=mejs.Utility.encodeUrl(c),d=mejs.Utility.encodeUrl(d)):t.enablePluginDebug&&(c=320,d=240),u.success=t.success,mejs.MediaPluginBridge.registerPluginElement(m,u,h),p.className="me-plugin",p.id=m+"_container",e.isVideo?h.parentNode.insertBefore(p,h):document.body.insertBefore(p,document.body.childNodes[0]),l=["id="+m,"isvideo="+(e.isVideo?"true":"false"),"autoplay="+(s?"true":"false"),"preload="+n,"width="+c,"startvolume="+t.startVolume,"timerrate="+t.timerRate,"flashstreamer="+t.flashStreamer,"height="+d],null!==e.url&&("flash"==e.method?l.push("file="+mejs.Utility.encodeUrl(e.url)):l.push("file="+e.url)),t.enablePluginDebug&&l.push("debug=true"),t.enablePluginSmoothing&&l.push("smoothing=true"),o&&l.push("controls=true"),t.pluginVars&&(l=l.concat(t.pluginVars)),e.method){case"silverlight":p.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+m+'" name="'+m+'" width="'+c+'" height="'+d+'" class="mejs-shim"><param name="initParams" value="'+l.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+t.pluginPath+t.silverlightName+'" /></object>';break;case"flash":mejs.MediaFeatures.isIE?(r=document.createElement("div"),p.appendChild(r),r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+m+'" width="'+c+'" height="'+d+'" class="mejs-shim"><param name="movie" value="'+t.pluginPath+t.flashName+"?x="+new Date+'" /><param name="flashvars" value="'+l.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'):p.innerHTML='<embed id="'+m+'" name="'+m+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="always" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="'+t.pluginPath+t.flashName+'" flashvars="'+l.join("&")+'" width="'+c+'" height="'+d+'" class="mejs-shim"></embed>';
break;case"youtube":var v=e.url.substr(e.url.lastIndexOf("=")+1);youtubeSettings={container:p,containerId:p.id,pluginMediaElement:u,pluginId:m,videoId:v,height:d,width:c},mejs.PluginDetector.hasPluginVersion("flash",[10,0,0])?mejs.YouTubeApi.createFlash(youtubeSettings):mejs.YouTubeApi.enqueueIframe(youtubeSettings);break;case"vimeo":u.vimeoid=e.url.substr(e.url.lastIndexOf("/")+1),p.innerHTML='<iframe src="http://player.vimeo.com/video/'+u.vimeoid+'?portrait=0&byline=0&title=0" width="'+c+'" height="'+d+'" frameborder="0" class="mejs-shim"></iframe>'}return h.style.display="none",u},updateNative:function(e,t,i,s){var n,o=e.htmlMediaElement;for(n in mejs.HtmlMediaElement)o[n]=mejs.HtmlMediaElement[n];return t.success(o,o),o}},mejs.YouTubeApi={isIframeStarted:!1,isIframeLoaded:!1,loadIframeApi:function(){if(!this.isIframeStarted){var e=document.createElement("script");e.src="http://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),this.isIframeStarted=!0}},iframeQueue:[],enqueueIframe:function(e){this.isLoaded?this.createIframe(e):(this.loadIframeApi(),this.iframeQueue.push(e))},createIframe:function(e){var t=e.pluginMediaElement,i=new YT.Player(e.containerId,{height:e.height,width:e.width,videoId:e.videoId,playerVars:{controls:0},events:{onReady:function(){e.pluginMediaElement.pluginApi=i,mejs.MediaPluginBridge.initPlugin(e.pluginId),setInterval(function(){mejs.YouTubeApi.createEvent(i,t,"timeupdate")},250)},onStateChange:function(e){mejs.YouTubeApi.handleStateChange(e.data,i,t)}}})},createEvent:function(e,t,i){var s={type:i,target:t};if(e&&e.getDuration){t.currentTime=s.currentTime=e.getCurrentTime(),t.duration=s.duration=e.getDuration(),s.paused=t.paused,s.ended=t.ended,s.muted=e.isMuted(),s.volume=e.getVolume()/100,s.bytesTotal=e.getVideoBytesTotal(),s.bufferedBytes=e.getVideoBytesLoaded();var n=s.bufferedBytes/s.bytesTotal*s.duration;s.target.buffered=s.buffered={start:function(e){return 0},end:function(e){return n},length:1}}t.dispatchEvent(s.type,s)},iFrameReady:function(){for(this.isLoaded=!0,this.isIframeLoaded=!0;this.iframeQueue.length>0;){var e=this.iframeQueue.pop();this.createIframe(e)}},flashPlayers:{},createFlash:function(e){this.flashPlayers[e.pluginId]=e;var t,i="http://www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+e.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";mejs.MediaFeatures.isIE?(t=document.createElement("div"),e.container.appendChild(t),t.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+e.pluginId+'" width="'+e.width+'" height="'+e.height+'" class="mejs-shim"><param name="movie" value="'+i+'" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'):e.container.innerHTML='<object type="application/x-shockwave-flash" id="'+e.pluginId+'" data="'+i+'" width="'+e.width+'" height="'+e.height+'" style="visibility: visible; " class="mejs-shim"><param name="allowScriptAccess" value="always"><param name="wmode" value="transparent"></object>'},flashReady:function(e){var t=this.flashPlayers[e],i=document.getElementById(e),s=t.pluginMediaElement;s.pluginApi=s.pluginElement=i,mejs.MediaPluginBridge.initPlugin(e),i.cueVideoById(t.videoId);var n=t.containerId+"_callback";window[n]=function(e){mejs.YouTubeApi.handleStateChange(e,i,s)},i.addEventListener("onStateChange",n),setInterval(function(){mejs.YouTubeApi.createEvent(i,s,"timeupdate")},250)},handleStateChange:function(e,t,i){switch(e){case-1:i.paused=!0,i.ended=!0,mejs.YouTubeApi.createEvent(t,i,"loadedmetadata");break;case 0:i.paused=!1,i.ended=!0,mejs.YouTubeApi.createEvent(t,i,"ended");break;case 1:i.paused=!1,i.ended=!1,mejs.YouTubeApi.createEvent(t,i,"play"),mejs.YouTubeApi.createEvent(t,i,"playing");break;case 2:i.paused=!0,i.ended=!1,mejs.YouTubeApi.createEvent(t,i,"pause");break;case 3:mejs.YouTubeApi.createEvent(t,i,"progress");break;case 5:}}},mejs.MediaElement}.call(t,s,t,e),!(void 0!==n&&(e.exports=n))}).call(t,s(5))},99:function(e,t,i){var s,n;try{s=[i(10),i(63)],n=function(e,t){var i=t.extend({tagName:"ul",className:"vf-user-meta vf-hlist vf-clearfix",templateName:"comment_user",events:{"click .vf-username":"showUser"},initialize:function(e){this.listenTo(this.model,"change",this.render),this.render()},render:function(){return this.$el.empty().append(this.template(this.model.toJSON())),this},showUser:function(t){t.prefentDefault(),e.trigger("/user/clicked",this.model)}});return i}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},100:function(e,t,i){var s,n;try{s=[i(9),i(10),i(63),i(28),i(101)],n=function(e,t,i,s,n){var o=i.extend({className:"vf-moderator-menu",templateName:"moderation",events:{"click .vf-spam-btn":"spamComment","click .vf-unspam-btn":"approveComment","click .vf-disable-btn":"disableComment","click .vf-approve-btn":"approveComment","click .vf-pick-btn":"pickComment","click .vf-unpick-btn":"unpickComment","click .vf-trust-btn":"trustUser","click .vf-untrust-btn":"untrustUser","click .vf-ban-btn":"banUser","click .vf-moderator-options":"onClick"},initialize:function(){e.bindAll(this,"onSuccess","onError"),this.user=this.model.user},render:function(){return this.$el.html(this.template({comment:this.model.toJSON(),user:this.user.toJSON()})),(this.user.isModOrAdmin()||this.user.isGuest())&&this.$(".vf-trust-btn, .vf-untrust-btn").remove(),this},onClick:function(){this.trigger("click")},spamComment:function(e){e.preventDefault(),this.model.save({status:"spam"},{error:this.onError})},approveComment:function(e){e.preventDefault(),this.model.save({status:"approved",date_edited:this.model.get("date_edited")},{error:this.onError})},disableComment:function(e){e.preventDefault(),this.model.save({status:"disabled"},{error:this.onError})},pickComment:function(e){e.preventDefault(),this.model.save({editor_pick:!0,date_edited:this.model.get("date_edited")},{error:this.onError})},unpickComment:function(e){e.preventDefault(),this.model.save({editor_pick:!1},{error:this.onError})},trustUser:function(e){e.preventDefault(),this.user.save({badge_trusted:!0},{success:this.onSuccess,error:this.onError})},onSuccess:function(){this.user.fetch({section:!1})},onError:function(e){this.trigger("error",e)},untrustUser:function(e){e.preventDefault(),this.user.save({badge_trusted:!1},{success:this.onSuccess,error:this.onError})},banUser:function(e){e.preventDefault();var t=this.user,i=new n;i.save({user_id:t.attributes.id,type:"hide"},{success:this.onSuccess,error:this.onError})}});return o}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},101:function(e,t,i){var s,n;try{s=[i(27)],n=function(e){var t=e.extend({url:"/bans"});return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},102:function(e,t,i){var s,n;try{s=[i(12),i(10),i(3),i(63)],n=function(e,t,i,s){var n=s.extend({templateName:"processing_status",initialize:function(e){this.comment=e.comment,this.currentUser=i.current.user,this.listenTo(this.comment,"change:processing_status",this.render),this.listenTo(this.comment.user,"change:ban_level",this.render)},render:function(){var e=this.comment.toJSON();return e.user=this.comment.user.toJSON(),e.current_user=this.currentUser.toJSON(),this.templateOnly(e),this}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},103:function(e,t,i){var s,n;try{s=[i(12),i(9),i(3),i(63),i(84),i(85),i(86),i(87),i(104),i(83),i(18)],n=function(e,t,i,s,n,o,r,a,l,h,c){var d=s.extend({mixins:[a,n,r],templateName:"comment_edit_form",className:"vf-comment-edit vf-clearfix",events:{"click .vf-comment-edit-cancel":"cancel","click .vf-comment-edit-save":"submit","keydown .vf-comment-container":"onTextChange","input .vf-comment-container":"onTextChange"},eventsForIE:{"click .vf-comment-edit-cancel":"cancel","click .vf-comment-edit-save":"submit","input .vf-comment-container":"onIETextChange","keyup .vf-comment-container":"onIETextChange","keydown .vf-comment-container":"onIETextChange"},initialize:function(e){if(t.bindAll(this,"onSuccess","onError"),this.countdown=new l,this.listenTo(this.countdown,"finish",this.onCountFinish),this.forceEncodeCount=c.getIEVersion()&&c.getIEVersion()<=9,this.model.hasEditTimeLeft()){var i=this.model.getEditTimeLeft();this.countdown.start(i)}this.$holder=e.holder,this.maxCharacters=this.domainSettings.get("comment_max_length"),this.showCharacterCount=this.maxCharacters-100,this.originalContent=this.model.get("content")},render:function(){var e=c.getIEVersion();0!==e&&e<=9&&this.delegateEvents(this.eventsForIE);var t={showTimer:this.model.hasEditTimeLimit(),comment:this.model.toJSON()};this.$el.html(this.template(t)),this.$saveButton=this.$(".vf-comment-edit-save"),this.$cancelButton=this.$(".vf-comment-edit-cancel"),this.$tipsyMask=this.$(".vf-tipsy-mask"),this.$("textarea").focus().trigger("input"),this.countdown.setElement(this.$(".vf-timer")),this.countdown.renderTime(),this.countdown.finished&&this.onCountFinish()},onTextChange:function(t){t&&t.ctrlKey&&13===t.keyCode&&"keydown"===t.type&&this.submit(t);var i=e(t.target);this.resizeWithLimit(i,100,400),this.onCharactersChange(t)},onIETextChange:function(t){var i=e(t.target);this.resizeTextarea(i),this.onCharactersChange(t)},replaceHolder:function(){this.$holder.replaceWith(this.$el)},revertHolder:function(){this.$el.replaceWith(this.$holder)},onCountFinish:function(){this.$(".vf-time-remaining-desc").empty(),this.$(".vf-timer").empty().text(this.i18n("timer_ended")),this.outOfTime=!0,this.disableSave(!0),this.$(".vf-tipsy-mask").tipsy({title:"timer_ended_tip"})},cancel:function(e){e&&e.preventDefault(),this.trigger("finish")},saveComment:function(){this.submittingComment=!0,this.disableSave(!0),this.$(".vf-error-message, .vf-char-count").empty(),this.$(".vf-comment-edit-save").loader("show");var e=!this.forceEncodeCount;this.model.save({content:this.model.get("content")},{xhr:e,success:this.onSuccess,error:this.onError})},onSuccess:function(e){this.submittingComment=!1,this.$(".vf-comment-edit-save").loader("hide"),this.enableSave(!0),this.trigger("finish")},onError:function(e){this.submittingComment=!1,this.enableSave(!0),this.model.set("content",this.originalContent),this.$(".vf-comment-edit-save").loader("hide");var t=h.codeToI18n(e.api_code),i=this.i18n.apply(this,t);this.showError(i)},showError:function(e){this.$(".vf-error-box").html("<div class='vf-error-message'>"+e+"<div>")},submit:function(e){e.preventDefault(),this.outOfTime||this.submittingComment||(this.model.set("content",o.cleanString(this.$("textarea").val())),this.validateComment(this.model)?this.originalContent===this.model.get("content")?this.cancel():this.saveComment():(this.model.set("content",this.originalContent),this.showError(this.commentError)))},onCharactersChange:function(t){if(!this.submittingComment&&!this.outOfTime){var i=e(t.target).val();this.countCharacters(i,this.showCharacterCount,this.maxCharacters,this.$(".vf-char-count"),this.$tipsyMask)?this.disableSave(!0):this.enableSave(!0)}},disableSave:function(e){!this.$saveButton||this.forcedDisabled!==!1&&e!==!0||(this.save=!1,this.$saveButton.attr("disabled",!0),this.$tipsyMask.show(),this.forcedDisabled=!!e)},enableSave:function(e){!this.$saveButton||this.forcedDisabled!==!1&&e!==!0||(this.save=!0,this.forcedDisabled=!1,this.$saveButton.removeAttr("disabled"),this.$tipsyMask.hide())},remove:function(){s.prototype.remove.call(this),this.countdown.stop()}});return d}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},104:function(e,t,i){var s,n;(function(o){try{s=[i(9),i(63),i(18)],n=function(e,t,i){var s=t.extend({initialize:function(){e.bindAll(this,"timerComplete"),this.started=!1,this.timerIntervalShort=1e3,this.timerIntervalMedium=1e4,this.timerIntervalLong=6e4},renderTime:function(){var e=this.getTimeLeftWords(this.endTime,this.domainSettings.currentTime());this.$el.html(e)},start:function(e){this.endTime=e,this.stop(),this.started=!0,this.timerComplete()},stop:function(){this.started=!1},timerComplete:function(){if(!this.started)return!1;this.renderTime();var e=i.getTimeLeft(this.endTime,this.domainSettings.currentTime());e>36e5?o(this.timerComplete,this.timerIntervalLong):e>9e5?o(this.timerComplete,this.timerIntervalMedium):e>0?o(this.timerComplete,this.timerIntervalShort):(this.finished=!0,this.trigger("finish"))}});return s}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},105:function(e,t,i){var s,n;try{s=[i(12),i(9),i(63),i(104)],n=function(e,t,i,s){var n=i.extend({templateName:"comment_user_actions",className:"vf-comment-user-actions",events:{"click .vf-comment-edit-link":"onEdit","click .vf-comment-remove-link":"onRemove"},confirmEvents:{"click .vf-yes":"onConfirmYes","click .vf-no":"onConfirmNo"},initialize:function(e){if(t.bindAll(this,"onRemoveSuccess","onRemoveError"),this.comment=e.comment,this.parent=e.parent,this.countdown=new s,this.listenTo(this.countdown,"finish",this.onCountFinish),this.comment.hasEditTimeLeft()){var i=this.comment.getEditTimeLeft();this.countdown.start(i)}},render:function(){var e={showTimer:this.comment.hasEditTimeLimit(),canUpdate:this.can("update",this.comment),canRemove:this.can("remove",this.comment)};this.$el.html(this.template(e)),this.delegateEvents(),this.countdown.setElement(this.$(".vf-timer")),this.countdown.renderTime()},renderConfirm:function(){this.parent.$(".vf-comment-html").addClass("vf-remove-confirm"),this.$el.html(this.template(null,"comment_confirm_remove")),this.delegateEvents(this.confirmEvents)},onEdit:function(e){e.preventDefault(),this.trigger("edit")},onRemove:function(e){e.preventDefault(),this.renderConfirm()},onConfirmNo:function(e){e.preventDefault(),this.render(),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),this.delegateEvents()},onConfirmYes:function(e){e.preventDefault(),this.$(".vf-no").loader("show",{position:"right"}),this.comment.destroy({success:this.onRemoveSuccess,error:this.onRemoveError})},onRemoveError:function(e,t){var i=t.error||this.i18n("something_went_wrong");this.$(".vf-error-message").remove(),this.$el.append("<div class='vf-error-message'>"+i+"</div>"),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),this.$(".vf-no").loader("hide")},onRemoveSuccess:function(e,t){this.$(".vf-no").loader("hide"),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),this.comment.set("processing_status",t.result.processing_status),this.trigger("remove")},onCountFinish:function(){this.locked=!0,this.trigger("lock")},remove:function(){i.prototype.remove.call(this),delete this.parent,this.countdown.stop()}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},106:function(e,t,i){var s,n;try{s=[i(63)],n=function(e){return e.extend({templateName:"preview",render:function(){var e=this.model.toJSON();return e.imageURL=this.model.largestImage().url,this.$el.html(this.template(e)),this.delegateEvents(),this}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},107:function(e,t,i){var s,n;try{s=[i(12),i(9),i(11),i(63)],n=function(e,t,i,s){var n=s.extend({templateName:"horizontal_list",initialize:function(e){this.views=[],this.view=e.view,this.canView=e.canView},render:function(){return this.templateOnly(),t.each(this.views,function(e){e.remove()}),this.views=[],this.collection&&this.setCollection(this.collection),this.collection.each(function(e,t,i){if(!this.canView||this.canView(e)){var s=new this.view({model:e,canView:this.canView,hasRealtime:this.options.hasRealtime});this.$el.append(s.render().$el),this.views.push(s)}}.bind(this)),this.updateFilterID(this.filter_id),this.trigger("render"),this},updateFilterID:function(e){this.filter_id=e,t.each(this.views,function(i){i.filter_id=e,t.isFunction(i.updateFilterID)&&i.updateFilterID(e)})},setCollection:function(e){this.collection&&this.stopListening(this.collection),this.collection=e,this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.onAddItem)},onAddItem:function(e,i,s){if(!this.canView||this.canView(e)){var n=s.at,o=new this.view({model:e,canView:this.canView,hasRealtime:this.options.hasRealtime}).render();o.filter_id=this.filter_id,t.isFunction(o.updateFilterID)&&o.updateFilterID(this.filter_id),s.prepend?this.$el.prepend(o.$el):0===n&&this.views.length>0?this.views[n].$el.before(o.$el):this.$el.append(o.el),this.views.splice(n,0,o),s.slide&&o.$el.hide().slideDown(),this.trigger("add")}},each:function(e,i){t.each(this.views,e,i)},clear:function(){this.each(function(e){e.remove()})}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},108:function(e,t,i){var s,n;try{s=[i(12),i(9),i(11),i(63),i(10),i(3),i(70),i(50)],n=function(e,t,i,s,n,o,r,a){return s.extend({templateName:"page_count",mixins:[r],initialize:function(e){this.listenTo(this.model,"change:num_replies",this.render),this.listenTo(this.model,"comment-created",this.incrementCount),e.hasRealtime&&this.listenTo(a,"content",this.realtimeUpdate)},render:function(){var e=this.model.toJSON();this.model.total_count&&(e.num_replies=this.model.total_count),this.templateOnly(e)},incrementCount:function(){this.model.set("num_replies",this.model.get("num_replies")+1)},realtimeUpdate:function(e){e&&this.filter_id&&this.filter_id===e.filter_id&&e.event_type&&"comment.enable"===e.event_type&&!this.isSelf(e,o.current.user)&&this.incrementCount()}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},156:function(e,t,i){var s,n;(function(o){try{s=[i(12),i(9),i(63),i(96),i(3),i(23),i(10),i(157),i(79),i(28),i(83),i(158),i(82)],n=function(e,t,s,n,r,a,l,h,c,d,m,u,p){return s.extend(p).extend({templateName:"account",id:"vf-modal-profile",events:{"click .vf-account-options li":"selectTab","click .vf-subscribe":"follow","click .vf-mute":"mute","submit form":"submitAccountEdit","mouseup input":"hideSuccess","change .vf-avatar-picker":"setAvatar","click .vf-set-default-avatar":"resetAvatar","click .vf-resend-verification-email":"resendVerification",'change input[name="vf_email"]':"checkEmailUpdate",'keyup input[name="vf_email"]':"checkEmailUpdate",'change input[name="vf_name"]':"checkNameUpdate",'keyup input[name="vf_name"]':"checkNameUpdate",'change input[type="password"].vf-js-password-required':"checkPasswordUpdate",'keyup input[type="password"].vf-js-password-required':"checkPasswordUpdate",'blur input[name="vf_old_password"]':"onCurrentPasswordBlur"},initialize:function(){t.bindAll(this,"onFollowSuccess","onFollowError","resendVerification","onEmailChange","checkEmailUpdate","onCurrentPasswordBlur","showPasswordRequired","checkPasswordUpdate","checkNameUpdate","onMuteSuccess","onMuteError"),this.model.toJSON||(this.model=new d(this.model)),this.initialMuteState=this.model.isMuted(),this.text_collection=this.model.comments({type:"text",section:null}),this.image_collection=this.model.comments({type:"image",section:null}),this.video_collection=this.model.comments({type:"video",section:null}),this.mute_collection=this.model.mutes(),t.bindAll(this,"canView");var e=i(159);this.text_commenting=new e({collection:this.text_collection,canView:this.canView}),this.image_commenting=new e({collection:this.image_collection,canView:this.canView}),this.video_commenting=new e({collection:this.video_collection,canView:this.canView});var s=i(161);this.muteList=new s({collection:this.mute_collection,canView:this.canView,userId:this.model.id}),this.listenTo(this.model,"change:subscribed",this.renderFollow),this.listenTo(this.model,"change:isMuted",this.renderMute),this.listenTo(this.model,"change:pic_small change:pic_small_pending change:name",this.renderUser),this.on("onModalClose",this.onModalClose)},canView:function(e,t){return e.has("user")&&e.get("user").id===this.model.id||this.model.isModOrAdmin()||"completed"===e.get("processing_status")},render:function(){this.text_commenting.fetch(),this.image_commenting.fetch(),this.video_commenting.fetch(),this.muteList.fetch({success:function(e){this.currentUser.set("mute_count",e.total_count),this.checkMuteLimit()}.bind(this)});var e=r.current.settings,t=this.model.toJSON(),i=e.get("enable_muting")&&this.model.id===this.currentUser.id&&!this.currentUser.isModOrAdmin(),s=e.get("enable_muting")&&this.model.id!==this.currentUser.id&&!this.currentUser.isModOrAdmin(),n=this.can("updateAvatar",this.model),o=this.can("updatePassword",this.model),h=this.can("updateName",this.model),c=this.can("updateEmail",this.model),d=this.can("updateNotifications",this.model),m=o||c,u=c||d||n||h||o,p=n||h||c,f=!(1!==e.get("enable_email_verification"));f||t.email||"pending_new"!==t.email_verification_status||(t.email=t.email_pending),this.model.hasUnapprovedUsername()&&(t.name=t.username_pending),this.model.hasUnapprovedAvatar()&&(t.pic_small=t.pic_small_pending,t.pic_large=t.pic_large_pending);var g={user:t,settings:e.toJSON(),showSettings:u,showMuteList:i,showMuteButton:s,canUpdateAvatar:n,canUpdatePassword:o,canUpdateName:h,canUpdateEmail:c,canUpdateNotifications:d,hasOptionsOrAvatar:p,emailVerification:f,showOldPasswordField:m,usernameModeration:this.model.hasUserModeration(),avatarModeration:this.model.hasAvatarModeration()};if(t.avatar_moderation_status=this.parseModerationStatus(t.avatar_moderation_status),"approved"!==t.avatar_moderation_status?g.alert_msg=a.translate("avatar_"+t.avatar_moderation_status+"_tip"):g.alert_msg=t.name,g.hideIcon=!g.avatarModeration||this.model.id!==this.currentUser.id||"approved"===t.avatar_moderation_status,this.$el.html(this.template(g,"account",["settings"])),this.successMessage=this.$(".vf-success-message"),this.verificationMessage=this.$(".vf-verification-message"),this.usernameModMessage=this.$(".vf-username-moderation-message"),this.avatarModMessage=this.$(".vf-avatar-moderation-message"),this.errorMessage=this.$(".vf-error-message"),this.$tabs=this.$el.find(".vf-account-options"),this.$el.find(".vf-text-container").html(this.text_commenting.render().$el),this.$el.find(".vf-video-container").html(this.video_commenting.render().$el),this.$el.find(".vf-images-container").html(this.image_commenting.render().$el),this.$el.find(".vf-mute-container").html(this.muteList.render().$el),this.checkMuteLimit(),this.renderFollow(),this.renderMute(),this.$(".vf-avatar").attr("onerror","this.src='"+this.model.defaults.pic_small+"'"),this.model.hasUnverifiedEmail()&&(this.renderUserModerationStatus("email"),"pending_update"===this.model.get("email_verification_status")&&(this.verificationMessage.find(".js-email").text(this.model.get("email_pending")),this.verificationMessage.addClass("vf-email-unverified").show())),this.model.hasUnapprovedUsername()){var v="pending";this.model.hasRejectedUsername()&&(v="rejected"),this.renderUserModerationStatus("name",v)}return g.hideIcon||this.initModerationTooltip("avatar",t.avatar_moderation_status),"default"!==this.options.tab&&this.selectTabOnRender(),this.$el.parents(".vf-modal").attr({"aria-labelledby":"vf-user-profile-label"}),l.trigger("/commenting/resize",this.$el),this},selectTabOnRender:function(){this.$(".vf-tabs li").removeClass("vf-current"),this.$(".vf-text-container").removeClass("vf-current");var e=this.options.tab.name;this.$("a.vf-"+e).parent("li").addClass("vf-current"),this.$(".vf-"+e+"-container").addClass("vf-current"),o(function(){this.$el.find("input[name='"+this.options.tab.focus+"']")[0].focus()}.bind(this),50)},renderFollow:function(){if(r.current.settings.get("disable_email_notifications"))return void this.$(".vf-subscribe").hide();var e=this.model.get("subscribed"),t=this.$(".vf-subscribe");t.toggleClass("hidden",this.model.id==this.currentUser.id),e?(t.text(this.i18n("unsubscribe_btn")),t.attr("data-title","unsubscribe-user")):(t.text(this.i18n("subscribe_btn")),t.attr("data-title","subscribe-user")),this.model.isMuted()&&t.addClass("inactive").attr("data-title","cannot-subscribe")},renderMute:function(){var e=this.$(".vf-mute");if(this.model.isMuted())e.addClass("vf-unmute").text(this.i18n("unmute_btn")),e.hasClass("inactive")||e.attr("data-title","unmute-user").attr("aria-label",this.i18n("unmute_user_desc")),this.$(".vf-subscribe").addClass("inactive").attr("data-title","cannot-subscribe");else if(!e.hasClass("inactive")){e.removeClass("vf-unmute").text(this.i18n("mute_btn")),e.attr("data-title","mute-user").attr("aria-label",this.i18n("mute_user_desc"));var t=this.model.hasSubscribed()?"unsubscribe-user":"subscribe-user";this.$(".vf-subscribe").removeClass("inactive").attr("data-title",t)}},emailChanged:function(){var e=this.$("form [data-validate=email]").val();return 1===r.current.settings.get("enable_email_verification")&&this.model.get("email_pending")?e!=this.model.get("email_pending"):e!=this.model.get("email")},selectTab:function(t){t.preventDefault();var i=e(t.target);this.$tabs.children("li").removeClass("vf-current"),i.parent().addClass("vf-current"),this.$el.find(".vf-is-content").removeClass("vf-current"),this.$el.find("."+i.data("container")).addClass("vf-current"),l.trigger("/commenting/resize",this.$el)},submitAccountEdit:function(t){t.preventDefault();var i=this.$("form"),s={},n=this.emailChanged();this.validateForm(i,n)&&(e.each(i.serializeArray(),function(e,t){s[t.name.replace(/vf_/,"")]=t.value}),!n&&(r.current.settings.get("enable_email_verification")&&(s.email===this.model.get("email_pending")||s.email===this.model.get("email")&&"approved"===this.model.get("email_verification_status")||!this.model.get("email_verification_status"))||!r.current.settings.get("enable_email_verification")&&s.email===this.model.get("email"))&&(s.email=null),delete s.avatar,this.hideSuccess(),l.trigger("/user/edit",s,{error:this.validateErrors.bind(this),success:this.showSuccess.bind(this)}))},showAPICodeErrors:function(e){if(e){var t,i=m.codeToI18n(e);switch(i=i.length>0?i[0]:""){case"user_update_email_in_use":t="vf_email";break;case"user_update_password_required":t="vf_old_password";break;case"user_update_picture_not_found":case"user_update_unrecognized_picture_format":t="avatar"}t&&this.$('[name="'+t+'"]').after(this.inlineError(this.i18n(i)))}},validateErrors:function(e){this.hideSuccess(),this.showServerErrors(e.validation_errors),this.showAPICodeErrors(e.api_code),this.errorMessage.show()},follow:function(t){t.preventDefault(),this.authorize("follow",this.model)?(e.fn.loader.hideErrors(),this.$(".vf-user-info .vf-subscribe").loader("show",{gifType:"blue"}).addClass("vf-loader-inverted vf-follow-loader"),this.model.toggleFollow({success:this.onFollowSuccess,error:this.onFollowError},{page_id:r.current.page.get("id")})):e.fn.tipsy.revalidate()},onFollowSuccess:function(){this.$(".vf-user-info .vf-subscribe").loader("hide")},onFollowError:function(){this.$(".vf-user-info .vf-subscribe").loader("error").addClass("vf-error-inverted").tipsy({title:"something_went_wrong",interactive:!0})},mute:function(t){t.preventDefault(),this.authorize("mute",this.model)?this.model.isMuted()?this.model.set("isMuted",!1):(this.initialMuteState||this.currentUser.get("mute_count")<r.current.settings.get("mute_limit"))&&(this.model.set("isMuted",!0),this.model.set("subscribed",!1),l.trigger("/user/subscribe",this.model.get("id"),!1)):e.fn.tipsy.revalidate()},updateMute:function(){e.fn.loader.hideErrors(),this.$(".vf-user-info .vf-mute").loader("show",{gifType:"blue"}).addClass("vf-loader-inverted vf-follow-loader"),this.model.toggleMute({success:this.onMuteSuccess,error:this.onMuteError},{page_id:r.current.page.get("id")})},checkMuteLimit:function(){!this.model.isMuted()&&this.currentUser.get("mute_count")>=r.current.settings.get("mute_limit")&&this.$(".vf-mute").addClass("inactive").attr("data-title","cannot-mute").attr("aria-label",this.i18n("cant_mute",r.current.settings.get("mute_limit")))},reloadComments:function(){l.trigger("/commenting/reload")},onMuteSuccess:function(){this.model.isMuted()?(this.model.toggleFollow({verb:"delete"},{page_id:r.current.page.get("id")}),this.currentUser.set("mute_count",this.currentUser.get("mute_count")+1)):this.currentUser.set("mute_count",this.currentUser.get("mute_count")-1),this.reloadComments()},onMuteError:function(){this.model.set("isMuted",!this.model.get("isMuted"))},onModalClose:function(){this.initialMuteState!==this.model.isMuted()?this.updateMute():this.muteList.hasUnmuted&&this.reloadComments()},showSuccess:function(e,i){var s=this;t.isEmpty(this.model.changed)?s.successMessage.show():t.each(this.model.changed,function(e,t,i){"email_pending"===t&&r.current.settings.get("enable_email_verification")?(s.verificationMessage.find(".js-email").text(e),s.verificationMessage.addClass("vf-email-unverified").show(),s.$(".vf-current-password").removeClass("required"),s.renderUserModerationStatus("email")):r.current.settings.get("enable_username_premoderation")&&"username_pending"===t?(s.renderUserModerationStatus("name","pending"),s.usernameModMessage.toggle("approved"!==s.model.get("username_moderation_status")),e=e||s.model.get("name"),s.$('input[name="vf_name"]').val(e),s.$(".vf-username").text(e)):i.username_pending&&"email_notice_frequency"===t?s.successMessage.text(s.i18n("profile_edit_setting_success",s.i18n(t+"_setting"))).show():s.successMessage.show()}),this.model.set(e.result),this.$(":password").val(""),this.$(".vf-current-password").removeClass("vf-is-required")},hideSuccess:function(e){this.successMessage.hide(),e&&"mouseup"!==e.type&&this.verificationMessage.hide(),this.$(".vf-error-message").remove(),this.$(".vf-error").removeClass("vf-error")},setAvatar:function(t){return this.upload=new c({restAPI:this.restAPI,file:e(t.target),type:"avatar",session:r.current.session.id}),this.listenTo(this.upload,"done",this.updateUser),this.listenTo(this.upload,"error",this.uploadError),this.upload.upload(),this},uploadError:function(){this.stopListening(this.upload),this.$(".vf-user-options").loader("error").addClass("vf-error-message").html(this.i18n("user_update_unrecognized_picture_format")),delete this.upload},updateUser:function(){this.avatarModMessage.css("display",""),this.model.fetch(),this.stopListening(this.upload),delete this.upload},renderUser:function(e){this.$(".vf-avatar").attr("src",e.get("pic_small_pending")||e.get("pic_small")),this.$(".vf-current-avatar img").attr("src",e.get("pic_small_pending")||e.get("pic_small")),this.$(".vf-header .vf-moderation-status-icon").removeClass().addClass("vf-moderation-status-icon vf-icon-"+this.parseModerationStatus(e.get("avatar_moderation_status"))+" vf-js-user-mod-icon").toggleClass("hidden","approved"===e.get("avatar_moderation_status")||0===e.get("avatar_moderation_status")),"approved"!==e.get("avatar_moderation_status")&&this.initModerationTooltip("avatar",e.get("avatar_moderation_status")),this.$(".vf-username").text(e.get("name"))},resetAvatar:function(e){e.preventDefault(),this.model.save({avatar:""}),this.model.set("pic_small",this.model.defaults.pic_small)},remove:function(){this.text_comments&&(this.text_comments.remove(),this.text_comments=null),this.video_comments&&(this.video_comments.remove(),this.video_comments=null),this.image_comments&&(this.image_comments.remove(),this.image_comments=null),this.muteList&&(this.muteList.remove(),this.muteList=null),s.prototype.remove.call(this)},initModerationTooltip:function(e,t){var i,s;switch(e){case"email":i="verify_email",s=".vf-js-email-needs-moderation .vf-js-user-mod-icon";break;case"name":i="name_"+t,s=".vf-js-name-needs-moderation .vf-js-user-mod-icon";break;case"avatar":i="avatar_"+this.parseModerationStatus(t),s=".vf-avatar-container .vf-js-user-mod-icon"}this.$(s).css({cursor:"pointer"}).attr("data-title",i+"_tip").tipsy({title:"data-title",gravity:"n",delayIn:100,delayOut:100})},onEmailChange:function(){var e=r.current.settings;1===e.get("enable_email_verification")&&this.model.hasUnverifiedEmail()&&(this.$(".vf-resend-verification").hide(),
this.$(".vf-js-email-needs-moderation").find(".vf-js-user-mod-icon").hide())},checkEmailUpdate:function(){var e=this.$('input[name="vf_email"]').val(),t=this.model.get("email_pending")?this.model.get("email_pending"):this.model.get("email");e===t?(this.$(".vf-resend-verification").show(),this.$(".vf-js-email-needs-moderation").find(".vf-js-user-mod-icon").show(),this.$(".vf-current-password").removeClass("vf-is-required")):(this.showPasswordRequired(),this.onEmailChange())},checkNameUpdate:function(){var e=this.$('input[name="vf_name"]').val(),t=this.model.get("username_pending")?this.model.get("username_pending"):this.model.get("name");this.$(".vf-js-name-needs-moderation").find(".vf-js-user-mod-icon").toggle(e===t)},showPasswordRequired:function(){this.$(".vf-current-password").hasClass("vf-is-required")||this.$(".vf-current-password").addClass("vf-is-required")},onCurrentPasswordBlur:function(){this.$(".vf-current-password").hasClass("vf-is-required")&&this.$('input[name="vf_old_password"]').val().length>0&&this.$(".vf-current-password").removeClass("vf-is-required")},checkPasswordUpdate:function(){var e=this.$('input[name="vf_new_password"]'),t=this.$('input[name="vf_confirm_password"]');""===e.val()&&""===t.val()?this.$(".vf-current-password").removeClass("vf-is-required"):this.showPasswordRequired()},renderUserModerationStatus:function(e,t){var i=new u({model:this.model,field:e,status:t}),s=this.$('input[name="vf_'+e+'"]');this.$(".vf-js-"+e+"-needs-moderation").length>0&&(s=this.$(".vf-js-"+e+"-needs-moderation")),"email"===e&&this.$(".vf-resend-verification").remove(),s.replaceWith(i.el),i.render(),this.initModerationTooltip(e,t)},parseModerationStatus:function(e){return e&&e.match(/pending/gi)?e="pending":this.model.isLoggedIn()&&"approved"!==e&&e||(e="approved"),e}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var r=i(6);r(e)}}).call(t,i(5))},157:function(e,t,i){var s,n;try{s=[i(63)],n=function(e){var t=e.extend({templateName:"user_header_view",render:function(){var e=this.model.get("username_pending")?this.model.get("username_pending"):this.model.get("name");this.$el.html(this.template({name:e}))}});return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},158:function(e,t,i){var s,n;try{s=[i(63)],n=function(e){return e.extend({templateName:"user_moderation_status",render:function(){var e,t="pending",i=this.model.toJSON(),s=this.options.field;"email"===s?e=i.email_pending||i.email:"name"===s&&(e=i.username_pending||i.name,"approved"===i.username_moderation_status&&(t="approved"),"rejected"===i.username_moderation_status&&(t="rejected"));var n={field:s,value:e,status:t,alert:s+"_"+t+"_alert"};this.templateOnly(n)}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},159:function(e,t,i){var s,n;try{s=[i(9),i(12),i(10),i(63),i(96),i(160)],n=function(e,t,i,s,n,o){var r=s.extend({events:{"click .vf-load-more":"onShowMore"},initialize:function(t){e.bindAll(this,"onFetchError","onFetchSuccess","loadMoreSuccess","loadMoreError"),this.comments=new n({tagName:"div",itemView:o,collection:this.collection,canView:t.canView}),this.listenTo(this.collection,"add",this.toggleShowMore)},fetch:function(){this.collection.fetch({batch:!0,error:this.onFetchError,success:this.onFetchSuccess})},onFetchError:function(){var e=this.i18n("something_went_wrong");this.$el.html("<div class='vf-error-message'>"+e+"<div>")},onFetchSuccess:function(){if(this.collection.isEmpty()){var e=this.i18n("profile_no_comments");this.currentUser==this.collection.user&&(e=this.i18n("profile_you_no_comments")),this.$el.html("<div class='vf-no-messages'>"+e+"</div>")}i.trigger("/commenting/resize",this.$el)},onShowMore:function(e){e.preventDefault(),this.$show_more_btn.children(".vf-error-message").remove(),this.$show_more_btn.hide(),this.$show_more_btn.loader("show",{loaderSize:"large",block:!0}),this.collection.fetchPageAfter({success:this.loadMoreSuccess,error:this.loadMoreError})},loadMoreSuccess:function(){this.$show_more_btn.loader("hide")},loadMoreError:function(){this.$show_more_btn.show().loader("hide"),this.$show_more_btn.children(".vf-error-message").remove();var e=this.i18n("something_went_wrong");this.$show_more_btn.append("<div class='vf-error-message'>"+e+"</div>")},render:function(){return this.$el.empty(),this.$el.append(this.comments.$el),this.$show_more=t(this.template({},"load_more")).hide(),this.$el.append(this.$show_more),this.$show_more_btn=this.$(".vf-load-more-con"),this.delegateEvents(),this},toggleShowMore:function(){this.$show_more.toggle(!!this.collection.after_count)},remove:function(){this.comments.remove(),this.$show_more=null,this.collection=null,s.prototype.remove.call(this)}});return r}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},160:function(e,t,i){var s,n;try{s=[i(93)],n=function(e){var t=e.extend({isProfileView:!0});return t}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},161:function(e,t,i){var s,n;try{s=[i(9),i(12),i(3),i(63),i(96),i(162)],n=function(e,t,i,s,n,o){var r=s.extend({events:{"click .vf-load-more":"onShowMore"},templateName:"mute_list",initialize:function(){e.bindAll(this,"onFetchError","loadMoreSuccess","loadMoreError","displayEmpty","onUnmute"),this.muteCollectionView=new n({tagName:"div",className:"vf-mute-list vf-clearfix",itemView:o,collection:this.collection,canView:function(){return!0}}),this.options.userId===this.currentUser.id&&(this.listenTo(this.collection,"remove",this.onUnmute),this.listenTo(this.collection,"add",this.toggleShowMore),this.listenTo(this.currentUser,"change:mute_count",this.updateCounter))},fetch:function(t){this.options.userId===this.currentUser.id?this.collection.fetch(e.extend({},t,{error:this.onFetchError,success:this.displayEmpty})):0===this.currentUser.id||this.currentUser.has("mute_count")||this.collection.fetch(t)},onFetchError:function(){var e=this.i18n("something_went_wrong");this.$el.html("<div class='vf-error-message'>"+e+"<div>")},onUnmute:function(){this.hasUnmuted=!0,this.displayEmpty()},displayEmpty:function(){this.currentUser.set("mute_count",this.collection.total_count),this.collection.isEmpty()?this.$el.html("<div class='vf-no-messages'>"+this.i18n("profile_no_mutes")+"</div>"):this.$(".vf-mute-counter span").text(i.current.settings.get("mute_limit")-this.collection.total_count)},onShowMore:function(e){e.preventDefault(),this.$show_more_btn.children(".vf-error-message").remove(),this.$show_more_btn.hide(),this.$show_more_btn.loader("show",{loaderSize:"large",block:!0}),this.collection.fetch({data:{after_id:this.collection.last().id},success:this.loadMoreSuccess,error:this.loadMoreError,remove:!1})},loadMoreSuccess:function(){this.$show_more_btn.loader("hide")},loadMoreError:function(){this.$show_more_btn.show().loader("hide"),this.$show_more_btn.children(".vf-error-message").remove();var e=this.i18n("something_went_wrong");this.$show_more_btn.append(this.template({message:e},"inline_error"))},toggleShowMore:function(){this.$show_more.toggle(!!this.collection.after_count)},updateCounter:function(){this.$(".vf-mute-counter span").text(i.current.settings.get("mute_limit")-this.currentUser.get("mute_count"))},render:function(){return this.$el.empty(),this.$el.html(this.template({mute_count:this.muteCollectionView.domainSettings.get("mute_limit")})),this.$el.append(this.muteCollectionView.$el),this.$show_more=t(this.template({},"load_more")).hide(),this.$el.append(this.$show_more),this.$show_more_btn=this.$(".vf-load-more-con"),this.delegateEvents(),this},remove:function(){this.muteCollectionView.remove(),this.$show_more=null,this.collection=null,s.prototype.remove.call(this)}});return r}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}},162:function(e,t,i){var s,n;try{s=[i(9),i(12),i(3),i(10),i(63)],n=function(e,t,i,s,n){return n.extend({events:{"click .vf-mute":"unmute","click .vf-avatar-container":"openProfile"},templateName:"muted_user",className:"vf-muted-user vf-clearfix",initialize:function(){n.prototype.initialize.call(this,arguments),this.model.set("isMuted",!0)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},unmute:function(e){e.preventDefault(),this.authorize("unmute",this.model)?(t.fn.loader.hideErrors(),this.$(".vf-user-info .vf-mute").loader("show",{gifType:"blue",position:"right"}).addClass("vf-follow-loader"),this.model.toggleMute({verb:"delete",success:this.onUnmuteSuccess.bind(this),error:this.onUnmuteError.bind(this)})):t.fn.tipsy.revalidate()},onUnmuteSuccess:function(){this.hasUnmuted=!0;var e=this.model.collection,t=function(){i.current.user.set("mute_count",this.total_count)}.bind(e);e.after_count>0?e.fetch({data:{after_id:e.last().id===this.model.id?e.at(e.length-2).id:e.last().id,limit:1},remove:!1,success:t,error:t}):(e.total_count--,t()),this.close()},onUnmuteError:function(){this.$(".vf-user-info .vf-mute").loader("error",{position:"right"}).tipsy({title:"something_went_wrong",interactive:!0})},openProfile:function(e){e.preventDefault(),e.stopPropagation(),s.trigger("/user/account/click",this.model)},close:function(){this.remove(),this.unbind(),this.model.collection.remove(this.model),this.model.unbind("change",this.modelChanged)}})}.apply(t,s),!(void 0!==n&&(e.exports=n))}catch(e){var o=i(6);o(e)}}});